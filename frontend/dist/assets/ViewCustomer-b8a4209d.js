import{a as e,F as H,j as s,A as P,r as c,b as I,P as T,c as S,L as d,p as _,h as E,I as $,v as g,m as J,z as Z,w as b,x as V}from"./index-583835ca.js";import{M as B,I as D}from"./MapComponent-1c2620f7.js";import{I as M}from"./IconPlus-c55af717.js";import{I as F}from"./IconCopy-ba17b987.js";const L=({className:t,fill:i=!1,duotone:l=!0})=>e(H,{children:i?l?s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("path",{d:"M6.94028 2C7.35614 2 7.69326 2.32421 7.69326 2.72414V4.18487C8.36117 4.17241 9.10983 4.17241 9.95219 4.17241H13.9681C14.8104 4.17241 15.5591 4.17241 16.227 4.18487V2.72414C16.227 2.32421 16.5641 2 16.98 2C17.3958 2 17.733 2.32421 17.733 2.72414V4.24894C19.178 4.36022 20.1267 4.63333 20.8236 5.30359C21.5206 5.97385 21.8046 6.88616 21.9203 8.27586L22 9H2.92456H2V8.27586C2.11571 6.88616 2.3997 5.97385 3.09665 5.30359C3.79361 4.63333 4.74226 4.36022 6.1873 4.24894V2.72414C6.1873 2.32421 6.52442 2 6.94028 2Z",fill:"currentColor"}),e("path",{opacity:l?"0.5":"1",d:"M21.9995 14.0001V12.0001C21.9995 11.161 21.9963 9.66527 21.9834 9H2.00917C1.99626 9.66527 1.99953 11.161 1.99953 12.0001V14.0001C1.99953 17.7713 1.99953 19.6569 3.1711 20.8285C4.34267 22.0001 6.22829 22.0001 9.99953 22.0001H13.9995C17.7708 22.0001 19.6564 22.0001 20.828 20.8285C21.9995 19.6569 21.9995 17.7713 21.9995 14.0001Z",fill:"currentColor"})]}):s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("path",{d:"M22 14V12C22 11.161 22 10.4153 21.9871 9.75H2.0129C2 10.4153 2 11.161 2 12V14C2 17.7712 2 19.6569 3.17157 20.8284C4.34315 22 6.22876 22 10 22H14C17.7712 22 19.6569 22 20.8284 20.8284C22 19.6569 22 17.7712 22 14Z",fill:"currentColor"}),e("path",{d:"M7.75 2.5C7.75 2.08579 7.41421 1.75 7 1.75C6.58579 1.75 6.25 2.08579 6.25 2.5V4.07926C4.81067 4.19451 3.86577 4.47737 3.17157 5.17157C2.47737 5.86577 2.19451 6.81067 2.07926 8.25H21.9207C21.8055 6.81067 21.5226 5.86577 20.8284 5.17157C20.1342 4.47737 19.1893 4.19451 17.75 4.07926V2.5C17.75 2.08579 17.4142 1.75 17 1.75C16.5858 1.75 16.25 2.08579 16.25 2.5V4.0129C15.5847 4 14.839 4 14 4H10C9.16097 4 8.41527 4 7.75 4.0129V2.5Z",fill:"currentColor"})]}):s("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("path",{d:"M2 12C2 8.22876 2 6.34315 3.17157 5.17157C4.34315 4 6.22876 4 10 4H14C17.7712 4 19.6569 4 20.8284 5.17157C22 6.34315 22 8.22876 22 12V14C22 17.7712 22 19.6569 20.8284 20.8284C19.6569 22 17.7712 22 14 22H10C6.22876 22 4.34315 22 3.17157 20.8284C2 19.6569 2 17.7712 2 14V12Z",stroke:"currentColor",strokeWidth:"1.5"}),e("path",{opacity:l?"0.5":"1",d:"M7 4V2.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:l?"0.5":"1",d:"M17 4V2.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:l?"0.5":"1",d:"M2 9H22",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}),W=()=>{const{id:t}=P(),[i,l]=c.useState({}),[m,o]=c.useState("loading"),[h,p]=c.useState([]);return c.useEffect(()=>{I.get(`/customers/${t}`).then(n=>{o("success"),p(n.data.companyTags),l(n.data.customer)}).catch(n=>{o("error"),console.log(n)}).finally(()=>{console.log("finally")})},[]),{customer:i,loadingStatus:m,companyTags:h}},q=()=>{var n,w,f,x,u,C;const{customer:t,loadingStatus:i}=W(),[l,m]=c.useState(3),o=a=>{navigator.clipboard.writeText(a).then(()=>{b("Phone number copied to clipboard")}).catch(r=>{V("Failed to copy phone number")})},h=a=>{window.confirm("Are you sure you want to remove this job?")&&I("job/"+a,{method:"DELETE"}).then(r=>{b("Job removed successfully"),window.location.reload()}).catch(r=>{V("Failed to remove job")})},p=()=>{};return console.log("CUSTOMER:",t),s(H,{children:[i==="loading"&&e(T,{}),i==="error"&&e(S,{}),i==="success"&&e("div",{className:"py-4",children:s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s("div",{className:"panel p-0",children:[s("div",{className:"flex items-center justify-between p-4",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Customer"}),e(d,{to:"/customer/update/"+(t.id??0)+"?redirectTo="+window.location.pathname,className:"ltr:ml-auto rtl:mr-auto btn btn-primary p-2 rounded-full",children:e(_,{className:"w-4 h-4"})})]}),s("div",{className:"mb-1",children:[s("div",{className:"flex flex-col justify-center items-center ",children:[e(B,{latitude:(n=t==null?void 0:t.address[0])==null?void 0:n.lat,longitude:(w=t==null?void 0:t.address[0])==null?void 0:w.lon}),e("p",{className:"font-semibold text-primary text-lg mt-4",children:t==null?void 0:t.name})]}),e("div",{className:"px-4 pb-4",children:s("ul",{className:"mt-5 flex flex-col m-auto space-y-4 font-semibold text-white-dark",children:[(f=t==null?void 0:t.address)==null?void 0:f.map((a,r)=>s("li",{className:"flex items-center gap-2",children:[e(E,{className:"shrink-0"}),e("a",{href:`https://www.google.com/maps?q=${encodeURIComponent(a.full)}`,target:"_blank",rel:"noopener noreferrer",children:a==null?void 0:a.full})]},r)),s("li",{className:"flex justify-between",children:[s("div",{className:"flex gap-2",children:[e(D,{}),e("span",{className:"whitespace-nowrap",dir:"ltr",children:e("a",{href:`tel:${t.phone}`,children:t==null?void 0:t.phone})})]}),e("button",{onClick:()=>o(t.phone||""),children:e(F,{className:"text-primary cursor-pointer"})})]}),e("li",{children:s("div",{className:"flex gap-2",children:[e($,{className:"w-5 h-5 shrink-0"}),e("span",{className:"text-primary truncate",children:t==null?void 0:t.email})]})})]})})]})]}),s("div",{className:"grid grid-cols-1 gap-3",children:[s("div",{className:"panel p-4",children:[s("div",{className:"flex items-center justify-between",children:[s("h3",{className:"font-semibold text-lg dark:text-white-light",children:["Jobs history (",t.jobs.length,")"]}),e(d,{to:`/appointment/create/${t.id}`,className:"ltr:ml-auto rtl:mr-auto btn btn-primary p-2 rounded-full",children:e(M,{className:"w-4 h-4"})})]}),s("div",{className:"appointments-list py-4",children:[(x=t==null?void 0:t.jobs)==null?void 0:x.slice(-l).map((a,r)=>{var v,N,y,k;return a.appointments.length>0?e(d,{to:`/appointment/${a.appointments[a.appointments.length-1].id}`,children:s("div",{className:"p-2 shadow bg-[#f4f4f4] dark:bg-white-dark/20 rounded border-l-2 mb-3",style:{borderColor:a.appointments[a.appointments.length-1].techs.length>0?a.appointments[a.appointments.length-1].techs[0].color:"#1565c0"},children:[s("div",{className:"px-4 flex items-center justify-between",children:[s("div",{className:"min-w-0 flex-1",children:[e("p",{className:"font-bold dark:text-gray-300",children:(v=a==null?void 0:a.services[0])==null?void 0:v.title}),e("p",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:(N=a==null?void 0:a.services[0])==null?void 0:N.description})]}),e("div",{className:`text-${a.remaining_balance>0?"danger":"success"} text-center text-[12px]`,children:g(a.remaining_balance>0?a.remaining_balance:a.total_paid)})]}),s("div",{className:"flex items-center justify-between px-4 mt-2",children:[s("div",{className:"flex items-center",children:[e(L,{className:"w-4 h-4"}),e("span",{className:"ml-2",children:J(a.appointments[a.appointments.length-1].start,"MMM DD, YYYY")})]}),s("div",{className:"",children:[a.appointments.length," Visits"]})]})]})},r):s("div",{className:"p-2 shadow bg-[#f4f4f4] dark:bg-white-dark/20 rounded border-l-2 mb-3 border-gray-500",children:[s("div",{className:"px-4 flex items-center justify-between w-full ",children:[s("div",{children:[e("p",{className:"font-bold dark:text-gray-300",children:(y=a==null?void 0:a.services[0])==null?void 0:y.title}),e("p",{className:"w-full max-w-xs whitespace-nowrap overflow-hidden text-ellipsis",children:(k=a==null?void 0:a.services[0])==null?void 0:k.description})]}),a.remaining_balance>0?e("div",{className:"text-danger text-center text-[12px]",children:g(a.remaining_balance)}):e("div",{className:"text-success text-center text-[12px]",children:g(a.total_paid)})]}),s("div",{className:"flex items-center justify-between px-4 mt-2",children:[s("div",{className:"flex items-center",children:[e(L,{className:"w-4 h-4"}),e(d,{to:`/appointment/create/${t.id}?job_id=${a.id}`,className:"ml-2 text-primary",children:"Create appointment"})]}),s("div",{className:"cursor-pointer text-danger flex",onClick:()=>{h(a.id)},children:[e(Z,{className:"mr-2"}),"Remove job"]})]})]},r)}),((u=t==null?void 0:t.jobs)==null?void 0:u.length)>l&&e("div",{className:"border-t border-white-light dark:border-white/10",children:s("div",{onClick:()=>{m(t.jobs.length)},className:"cursor-pointer group group flex items-center justify-center p-4 font-semibold hover:text-primary",children:["View All ",t.jobs.length," Jobs",e("svg",{className:"h-4 w-4 transition duration-300 group-hover:translate-x-1 ltr:ml-1 rtl:mr-1 rtl:rotate-180 rtl:group-hover:-translate-x-1",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M4 12H20M20 12L14 6M20 12L14 18",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})})]})})]})]}),s("div",{className:"panel",children:[s("div",{className:"flex items-center justify-between",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Tags"}),e("button",{className:"btn btn-primary p-2 rounded-full",onClick:p,children:e(M,{className:"w-4 h-4"})})]}),e("div",{className:"teags-list",children:(C=t==null?void 0:t.tags)==null?void 0:C.map((a,r)=>e("div",{className:"tag-item",children:e("span",{className:"text-primary",children:a.name})},r))})]})]}),e("div",{className:"panel"})]})})]})};export{q as default};
