import{r as o,a as l,j as D,L as H,g as v,e as W,u as F,h as Y,i as j,s as V,b as B,k as I,P as $,c as z}from"./index-41408ffa.js";const U=e=>{const n=e.appointmentTiles||[],t=e.daysArray||[],a=e.defaultAppointmentOpacity,i=e.defaultAppointmentBgColor,s=e.timesArray||[];e.totalDuration;const r=e.blockHeight||50;e.onAppointmentClick;const d=e.setAppointmentStyle||null,m=o.useRef(null);o.useRef(0),o.useRef(0),o.useRef(!1),o.useRef(0),o.useRef(0),o.useRef(0),o.useRef(null),o.useRef(0),o.useRef(0),o.useRef(0),o.useRef(0),o.useRef(0),o.useRef(!1);const c=u=>{},T=()=>{},y=u=>{let h={backgroundColor:u.appointment.backgroundColor??i,inset:"1px",opacity:u.appointment.opacity??a},f={color:"#fff"},p={},b={};return d&&({extendedBackgroundStyles:p,extendedTitleStyle:b}=d(u.appointment)),h={...h,...p},f={...f,...b},{backgroundStyles:h,titleStyles:f}};return l("div",{className:"dates grid  w-full",style:{gridTemplateColumns:`repeat(${t.length}, minmax(0, 1fr))`},children:t.map((u,h)=>l("div",{className:"date pt-2 first:border-0 border-l dark:border-gray-600 border-gray-300",children:D("div",{className:"day-inner relative h-full",ref:m,children:[l("div",{className:"appointments-list overflow-hidden absolute h-full left-0 top-0 right-0",onMouseUp:T,onMouseMove:c,children:n[h]&&n[h].map((f,p)=>D(H,{to:`/appointment/${f.appointment.id}`,className:"appointment text-[.8em]  absolute p-[2px] cursor-pointer",style:{height:f.height+"%",width:f.width+"%",left:f.left+"%",top:f.top+"%"},children:[l("div",{className:"appointment-conteiner rounded absolute",style:y(f).backgroundStyles}),l("div",{className:"sticky font-bold",style:y(f).titleStyles,children:l("div",{className:"appointment-title px-2 pt-1 hover:underline ",children:f.appointment.title})})]},f.appointment.title+"-"+p+f.top))}),s.map((f,p)=>l("div",{className:"date-time dark:border-gray-600 border-gray-300 border-t",style:{height:r+"px"}},p))]})},h))})},G=e=>{const{blockHeight:n,timesArray:t}=e;return l("div",{className:"times text-[0.8em] w-10 pt-2",children:t.map((a,i)=>l("div",{className:"time  border-t border-transparent",style:{height:n+"px"},children:l("div",{className:"time-title  -mt-2",children:a})},i))})},S=e=>{const n=new Date;let t=0,a=0;const i=e.match(/^(\d{1,2})\s?(am|pm)$/i);i&&(t=parseInt(i[1]),i[2].toLowerCase()==="pm"&&t!==12&&(t+=12),i[2].toLowerCase()==="am"&&t===12&&(t=0));const s=e.match(/^(\d{1,2}):(\d{2})$/);return s&&(t=parseInt(s[1]),a=parseInt(s[2])),new Date(n.getFullYear(),n.getMonth(),n.getDate(),t,a,0)},N=(e,n)=>{const t=new Date(e);return t.setTime(t.getTime()+n*24*60*60*1e3),t},x=(e,n)=>{const t=new Date(e);return t.setTime(t.getTime()+n*7*24*60*60*1e3),t},q=(e,n,t,a)=>{const i=r=>{const d=r.getDay(),m=r.getDate()-d+(d===0?-6:1);return new Date(r.setDate(m))},s=(r,d)=>{const m=new Date(r);return m.setHours(d.getHours(),d.getMinutes(),0,0),m};if(a==="week"){const r=i(e),d=new Date(r);return d.setDate(r.getDate()+6),{start:s(r,n),end:s(d,t)}}else if(a==="day")return{start:s(e,n),end:s(e,t)}},J=(e,n,t,a)=>{const i=new Date(e.getTime()),s=new Date(n.getTime()),r=[];for(i.getTime()===s.getTime()&&s.setDate(s.getDate()+1);i<=s;)r.push(v(i,t)),i.setHours(i.getHours()+a);return r},K=(e,n)=>{const t=[],a=new Date,i=new Date(e.getTime()),s=i.getDay(),r=(s===0?-6:1)-s;if(i.setDate(i.getDate()+r),n==="day")return[{title:v(e,"DDD DD"),isSelect:e.getFullYear()===a.getFullYear()&&e.getMonth()===a.getMonth()&&e.getDate()===a.getDate(),date:e}];for(let d=0;d<7;d++){const m=v(i,"DDD DD");t.push({title:m,isSelect:i.getFullYear()===a.getFullYear()&&i.getMonth()===a.getMonth()&&i.getDate()===a.getDate(),date:new Date(i.getTime())}),i.setDate(i.getDate()+1)}return t},Q=(e,n,t)=>e.filter(s=>(s.start=new Date(s.start),s.end=new Date(s.end),s.start.getTime()>=n.getTime()&&s.start.getTime()<=t.getTime()||s.end.getTime()>=n.getTime()&&s.end.getTime()<=t.getTime()||s.start.getTime()<n.getTime()&&s.end.getTime()>t.getTime())).sort((s,r)=>r.start-s.start),X=(e,n,t)=>{const a=new Date(n.getTime()),i=new Date(t.getTime());let s=new Array;for(;a.getTime()<i.getTime();){const r=new Date(a.getTime());r.setHours(i.getHours());const d=e.filter(c=>{const T=typeof c.start=="string"?new Date(c.start):c.start,y=typeof c.end=="string"?new Date(c.end):c.end;return T.getTime()>=a.getTime()&&T.getTime()<r.getTime()||y.getTime()>a.getTime()&&y.getTime()<=r.getTime()||T.getTime()<a.getTime()&&y.getTime()>r.getTime()});let m=[];d.forEach(c=>{const{top:T,height:y}=Z(a,r,c.start,c.end);let u={start:c.start,end:c.end,appointment:c,top:T,left:null,width:null,height:y};m.push(u)});for(let c=0;c<m.length;c++)M(m[c],m);for(let c=0;c<m.length;c++)M(m[c],m);s.push(m),a.setDate(a.getDate()+1)}return s},Z=(e,n,t,a)=>{const i=(n.getTime()-e.getTime())/1e3/60+60,s=t.getTime()<e.getTime()?0:(t.getTime()-e.getTime())/1e3/60,d=(a.getTime()>n.getTime()?i:(a.getTime()-e.getTime())/1e3/60)-s,m=s/i*100,c=d/i*100;return{top:m,height:c}},M=(e,n)=>{const t=_(e,n);if(t.length===0){e.left=0,e.width=100;return}const a=ee(t);if(a)e.left=a.left,e.width=a.width;else{t.push(e);const i=100/t.length;t.forEach((s,r)=>{s.left=r*i,s.width=i})}},_=(e,n)=>n.filter(t=>e===t?!1:e.start.getTime()>=t.start.getTime()&&e.start.getTime()<t.end.getTime()||e.end.getTime()>t.start.getTime()&&e.end.getTime()<=t.end.getTime()||e.start.getTime()<t.start.getTime()&&e.end.getTime()>t.end.getTime()),ee=e=>{e.sort((t,a)=>(t.left??0)-(a.left??0));let n=0;for(const t of e)if(t.left!==null){if(t.left>n)return{left:n,width:t.left-n};n=Math.max(n,t.left+(t.width??0))}return n<100?{left:n,width:100-n}:null},te=e=>{const{selectedDay:n,daysArray:t}=e;return D("div",{className:"scheduler-weekdays flex mt-2 border-b dark:border-gray-600 border-gray-300",children:[l("div",{className:"first-item w-10"}),l("div",{className:"weekdays text-center grid w-full",style:{gridTemplateColumns:`repeat(${t.length}, minmax(0, 1fr))`},children:t.map((a,i)=>l("div",{className:`weekday py-2 ${a.isSelect?"dark:bg-blue-900 bg-blue-300 rounded-t dark:text-white text-black":""}`,children:a.title},i))},t.length)]})},ne=e=>{const n=o.useMemo(()=>S(e.startTime||"00:00"),[e.startTime]),t=o.useMemo(()=>S(e.endTime||"23:00"),[e.endTime]),a=o.useMemo(()=>e.onClickHandler||null,[e.onClickHandler]),i=o.useMemo(()=>e.setAppointmentStyle||null,[e.setAppointmentStyle]),s=o.useMemo(()=>e.onCurrentDateChange||null,[e.onCurrentDateChange]),r=e.viewType||"week",d=e.blockHeight||50,m=e.defaultAppointmentOpacity||.8,c=e.isHeader!==void 0?e.isHeader:!0,T=e.isDaysNames!==void 0?e.isDaysNames:!0,y=new Date,[u,h]=o.useState(new Date);o.useEffect(()=>{h(e.currentDate?new Date(e.currentDate):new Date)},[e.currentDate]);const[f,p]=o.useState(new Date),[b,g]=o.useState(new Date);o.useEffect(()=>{const A=q(u,n,t,r);A&&(p(A.start),g(A.end)),s&&s(u)},[u,n,t,r]);const w=J(n,t,"hh A",1),k=K(u,r),C=o.useMemo(()=>Q(e.appointments||[],f,b),[e.appointments,f,b]),R=o.useMemo(()=>X(C,f,b),[C]),P=e.defaultAppointmentBgColor||"#1565c0",O=()=>{r==="week"&&h(x(u,-1)),r==="day"&&h(N(u,-1))},L=()=>{r==="week"&&h(x(u,1)),r==="day"&&h(N(u,1))},E=()=>{h(y)};return l("div",{className:"select-none",children:D("div",{className:"scheduler-container dark:bg-black rounded p-4",children:[c&&D("div",{className:"scheduler-header flex justify-between",children:[l("div",{className:"scheduler-date text-base",children:v(u,"MMMM YYYY")}),D("div",{className:"scheduler-nav flex gap-4",children:[l("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:O,children:"<"}),l("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:E,children:"Today"}),l("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:L,children:">"})]})]}),D("div",{className:"scheduler-body",children:[T&&l(te,{selectedDay:u,daysArray:k}),D("div",{className:"scheduler-dates flex relative",children:[l(G,{timesArray:w,blockHeight:d}),l(U,{blockHeight:d,startTime:n,endTime:t,timesArray:w,daysArray:k,appointmentTiles:R,onAppointmentClick:a,defaultAppointmentOpacity:m,defaultAppointmentBgColor:P,setAppointmentStyle:i})]})]})]})})},ae=()=>{const e=W(),n=F(),[t,a]=o.useState([]),[i,s]=o.useState("day"),r=Y(g=>g.themeConfig.theme),[d,m]=j(),[c,T]=o.useState(new Date);o.useEffect(()=>{e(V("Schedule"))});const[y,u]=o.useState("loading");o.useEffect(()=>{u("success"),u("loading"),B.get("/appointment").then(w=>{console.log(w.data.appointments),a(w.data.appointments),u("success")}).catch(w=>{u("error"),console.log(w)});const g=d.get("currentDate");g&&T(new Date(g))},[]),o.useEffect(()=>{const g=()=>{window.innerWidth<768?s("day"):s("week")};return window.addEventListener("resize",g),g(),()=>{window.removeEventListener("resize",g)}},[]);const h=g=>{n("/appointment/"+g)};return D("div",{children:[D("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[l("h2",{className:"text-xl",children:"Schedule"}),l("div",{className:"flex gap-2 md:justify-end justify-around mb-2",children:l("div",{className:"flex-auto md:flex-none ",children:D(H,{to:"/schedule/maps/todays",className:"flex items-center ",children:[l(I,{className:"mr-1"}),"Map View"]})})})]}),y==="loading"&&l($,{}),y==="error"&&l(z,{}),y==="success"&&l("div",{className:"py-4",children:l(ne,{onCurrentDateChange:g=>{console.log(g),d.set("currentDate",g.toISOString()),m(d)},startTime:"07:00",endTime:"20:00",currentDate:c,viewType:i,appointments:t,onClickHandler:g=>{h(g.id)},setAppointmentStyle:g=>{console.log(g);let w={},k={};return g.status===2&&(w={backgroundColor:r==="dark"?"#4a4a4ab0":"#ccc",borderLeft:"3px solid "+g.backgroundColor},k={color:r==="dark"?"#ffffff":"#000000"}),{extendedBackgroundStyles:w,extendedTitleStyle:k}}})})]})};export{ae as default};
