import{r as s,h as G,a as e,l as be,m as le,n as xe,b as j,F as _,j as l,u as J,B as Z,t as L,_ as $,g as A,v as R,o as we,p as H,q as O,L as V,w as ie,k as Ne,I as se,x as Ce,y as q,S as Q,z as ke,A as Se,C as Te,P as Fe,c as je,e as De,s as Le}from"./index-41408ffa.js";import{T as K,a as Me,S as Ie}from"./ServicesList-7a3691e9.js";import{I as Pe}from"./IconPhone-97d0adc2.js";import{I as re}from"./IconCopy-f2d85a90.js";import{I as Ae}from"./IconPlus-9dd95e34.js";import{I as ce}from"./IconTrash-a3df4d05.js";import{h as $e}from"./moment-a9aaa855.js";const de=s.createContext(null),E=()=>{const a=s.useContext(de);if(!a)throw new Error("useAppointmentContext must be used within an AppointmentProvider");return a},_e=({children:a,appointmentData:d})=>{const[t,h]=s.useState(d),[r,v]=s.useState("loading"),f=G(o=>o.themeConfig.companyInfo.taxRate),w={appointment:t,setAppointment:h,updateStatus:o=>{t&&h({...t,status:o})},updateNotes:o=>{t&&h({...t,notes:o})},updatePayments:o=>{if(t){const n={...t.job,payments:o,total_paid:be(o),remaining_balance:le(o,t.job.total_amount)};h({...t,job:n})}},updateServices:o=>{if(t){const{tax:n,total:i}=xe(o,f),m={...t.job,services:o,total_amount:i,total_tax:n,remaining_balance:le(t.job.payments,i)};h({...t,job:m})}},updateTime:(o,n)=>{if(t){const i={...t,start:o,end:n,job:{...t.job,appointments:t.job.appointments.map(m=>m.id===t.id?{...m,start:o,end:n}:m)}};h(i)}},updateImages:o=>{t&&h({...t,images:o})},updateTechs:o=>{t&&h({...t,techs:o})},fetchAppointmentData:o=>{v("loading"),console.log("fetching appointment"),j.get(`/appointment/${o}`).then(n=>{console.log(n.data);let i=n.data.appointment;h(i),v("success")}).catch(n=>{console.log(n),v("error")})},loadingStatus:r,updateTags:o=>{t&&h({...t,job:{...t.job,tags:o}})}};return e(de.Provider,{value:w,children:a})},Ee=({className:a,fill:d=!1,duotone:t=!0})=>e(_,{children:d?l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{opacity:t?"0.5":"1",d:"M3.46447 20.5355C4.92893 22 7.28595 22 12 22C16.714 22 19.0711 22 20.5355 20.5355C22 19.0711 22 16.714 22 12C22 7.28595 22 4.92893 20.5355 3.46447C19.0711 2 16.714 2 12 2C7.28595 2 4.92893 2 3.46447 3.46447C2 4.92893 2 7.28595 2 12C2 16.714 2 19.0711 3.46447 20.5355Z",fill:"currentColor"}),e("path",{d:"M18.581 9.47431C18.843 9.15344 18.7952 8.68098 18.4743 8.41903C18.1534 8.15709 17.681 8.20486 17.419 8.52573L12.2514 14.8559C12.0385 14.7803 11.7939 14.8014 11.5901 14.9345C11.2432 15.1609 11.1456 15.6256 11.372 15.9724L11.6575 16.4099C11.7883 16.6103 12.0068 16.7362 12.2457 16.749C12.4846 16.7617 12.7153 16.6597 12.8666 16.4743L18.581 9.47431Z",fill:t?"currentColor":"white"}),e("path",{d:"M14.581 9.47431C14.843 9.15343 14.7952 8.68097 14.4743 8.41903C14.1534 8.15709 13.681 8.20487 13.419 8.52574L8.28574 14.814L6.58102 12.7257C6.31908 12.4049 5.84662 12.3571 5.52574 12.619C5.20487 12.881 5.15709 13.3534 5.41903 13.6743L7.70474 16.4743C7.84718 16.6488 8.0605 16.75 8.28574 16.75C8.51098 16.75 8.7243 16.6488 8.86673 16.4743L14.581 9.47431Z",fill:t?"currentColor":"white"})]}):l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[e("path",{opacity:t?"0.5":"1",d:"M4 12.9L7.14286 16.5L15 7.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M20.0002 7.5625L11.4286 16.5625L11.0002 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),He=({className:a,fill:d=!1,duotone:t=!0})=>e(_,{children:d?t?l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[e("path",{opacity:t?"0.5":"1",d:"M9.99976 20H13.9998C17.771 20 19.6566 20 20.8282 18.8284C21.9998 17.6569 21.9998 15.7712 21.9998 12C21.9998 11.5581 21.9981 10.392 21.9962 10H2C1.99811 10.392 1.99976 11.5581 1.99976 12C1.99976 15.7712 1.99976 17.6569 3.17133 18.8284C4.34291 20 6.22852 20 9.99976 20Z",fill:"currentColor"}),e("path",{d:"M9.99484 4H14.0052C17.7861 4 19.6766 4 20.8512 5.11578C21.6969 5.91916 21.9337 7.07507 22 9V10H2V9C2.0663 7.07507 2.3031 5.91916 3.14881 5.11578C4.3234 4 6.21388 4 9.99484 4Z",fill:"currentColor"}),e("path",{d:"M12.5 15.25C12.0858 15.25 11.75 15.5858 11.75 16C11.75 16.4142 12.0858 16.75 12.5 16.75H14C14.4142 16.75 14.75 16.4142 14.75 16C14.75 15.5858 14.4142 15.25 14 15.25H12.5Z",fill:"currentColor"}),e("path",{d:"M6 15.25C5.58579 15.25 5.25 15.5858 5.25 16C5.25 16.4142 5.58579 16.75 6 16.75H10C10.4142 16.75 10.75 16.4142 10.75 16C10.75 15.5858 10.4142 15.25 10 15.25H6Z",fill:"currentColor"})]}):l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[e("path",{d:"M14 4H10C6.22876 4 4.34315 4 3.17157 5.17157C2.32803 6.01511 2.09185 7.22882 2.02572 9.25H21.9743C21.9082 7.22882 21.672 6.01511 20.8284 5.17157C19.6569 4 17.7712 4 14 4Z",fill:"currentColor"}),e("path",{d:"M10 20H14C17.7712 20 19.6569 20 20.8284 18.8284C22 17.6569 22 15.7712 22 12C22 11.5581 22 11.142 21.9981 10.75H2.00189C2 11.142 2 11.5581 2 12C2 15.7712 2 17.6569 3.17157 18.8284C4.34315 20 6.22876 20 10 20Z",fill:"currentColor"}),e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.25 16C5.25 15.5858 5.58579 15.25 6 15.25H10C10.4142 15.25 10.75 15.5858 10.75 16C10.75 16.4142 10.4142 16.75 10 16.75H6C5.58579 16.75 5.25 16.4142 5.25 16Z",fill:"white"}),e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.75 16C11.75 15.5858 12.0858 15.25 12.5 15.25H14C14.4142 15.25 14.75 15.5858 14.75 16C14.75 16.4142 14.4142 16.75 14 16.75H12.5C12.0858 16.75 11.75 16.4142 11.75 16Z",fill:"white"})]}):l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[e("path",{d:"M2 12C2 8.22876 2 6.34315 3.17157 5.17157C4.34315 4 6.22876 4 10 4H14C17.7712 4 19.6569 4 20.8284 5.17157C22 6.34315 22 8.22876 22 12C22 15.7712 22 17.6569 20.8284 18.8284C19.6569 20 17.7712 20 14 20H10C6.22876 20 4.34315 20 3.17157 18.8284C2 17.6569 2 15.7712 2 12Z",stroke:"currentColor",strokeWidth:"1.5"}),e("path",{opacity:t?"0.5":"1",d:"M10 16H6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:t?"0.5":"1",d:"M14 16H12.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:t?"0.5":"1",d:"M2 10L22 10",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}),Re=({className:a,fill:d=!1,duotone:t=!0})=>l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[e("path",{d:"M9.5 7L4.5 12L9.5 17",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{opacity:t?"0.5":"1",d:"M4.5 12L14.5 12C16.1667 12 19.5 13 19.5 17",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),Be=({className:a,fill:d=!1,duotone:t=!0})=>e(_,{children:d?l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[e("path",{opacity:t?"0.5":"1",d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 7.25C12.4142 7.25 12.75 7.58579 12.75 8V11.6893L15.0303 13.9697C15.3232 14.2626 15.3232 14.7374 15.0303 15.0303C14.7374 15.3232 14.2626 15.3232 13.9697 15.0303L11.4697 12.5303C11.329 12.3897 11.25 12.1989 11.25 12V8C11.25 7.58579 11.5858 7.25 12 7.25Z",fill:t?"currentColor":"white"})]}):l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[e("circle",{opacity:t?"0.5":"1",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"1.5"}),e("path",{d:"M12 8V12L14.5 14.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),Ze=({className:a,fill:d=!1,duotone:t=!0})=>e(_,{children:d?l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[e("path",{opacity:t?"0.5":"1",d:"M13.1061 22H10.8939C7.44737 22 5.72409 22 4.54903 20.9882C3.37396 19.9764 3.13025 18.2827 2.64284 14.8952L2.36407 12.9579C1.98463 10.3208 1.79491 9.00229 2.33537 7.87495C2.87583 6.7476 4.02619 6.06234 6.32691 4.69181L7.71175 3.86687C9.80104 2.62229 10.8457 2 12 2C13.1543 2 14.199 2.62229 16.2882 3.86687L17.6731 4.69181C19.9738 6.06234 21.1242 6.7476 21.6646 7.87495C22.2051 9.00229 22.0154 10.3208 21.6359 12.9579L21.3572 14.8952C20.8697 18.2827 20.626 19.9764 19.451 20.9882C18.2759 22 16.5526 22 13.1061 22Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 18.75C11.5858 18.75 11.25 18.4142 11.25 18V15C11.25 14.5858 11.5858 14.25 12 14.25C12.4142 14.25 12.75 14.5858 12.75 15V18C12.75 18.4142 12.4142 18.75 12 18.75Z",fill:"currentColor"})]}):l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[e("path",{opacity:t?"0.5":"1",d:"M2 12.2039C2 9.91549 2 8.77128 2.5192 7.82274C3.0384 6.87421 3.98695 6.28551 5.88403 5.10813L7.88403 3.86687C9.88939 2.62229 10.8921 2 12 2C13.1079 2 14.1106 2.62229 16.116 3.86687L18.116 5.10812C20.0131 6.28551 20.9616 6.87421 21.4808 7.82274C22 8.77128 22 9.91549 22 12.2039V13.725C22 17.6258 22 19.5763 20.8284 20.7881C19.6569 22 17.7712 22 14 22H10C6.22876 22 4.34315 22 3.17157 20.7881C2 19.5763 2 17.6258 2 13.725V12.2039Z",stroke:"currentColor",strokeWidth:"1.5"}),e("path",{d:"M12 15L12 18",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}),We=()=>{var te,ae;const{appointment:a,updateStatus:d,updatePayments:t}=E(),h=((te=a==null?void 0:a.job)==null?void 0:te.total_amount)||0,r=((ae=a==null?void 0:a.job)==null?void 0:ae.remaining_balance)||0,[v,f]=s.useState(!1),[u,y]=s.useState(!1),[x,C]=s.useState(!1),p=["Credit","Transfer","Check","Cash"],[g,k]=s.useState(0),[S,c]=s.useState("full"),[w,o]=s.useState(r),n=J(),[i,m]=s.useState(!1),[F,M]=s.useState("timeFrom"),[b,D]=s.useState(new Date),[W,z]=s.useState(new Date),[T,I]=s.useState(!1),[B,U]=s.useState(!0),[Y,he]=s.useState(!0),[me,X]=s.useState(!1);s.useEffect(()=>{o(r)},[r]);const ue=N=>{D(new Date(N)),T||z(new Date(N.getTime()+60*120*1e3))},fe=N=>{I(!0),z(new Date(N))},pe=N=>{if(isNaN(N.target.value))return;const P=N.target.value;o(P)},ee=N=>{N==="full"?(o(r),c("full")):N==="deposit"&&(o(100),c("deposit"))},ge=()=>{C(!0),w>0?j.post(`appointment/payment/${a==null?void 0:a.job_id}`,{amount:w,payment_type:p[g],send_invoice:Y}).then(N=>{N.data.info&&we(N.data.info),t([...(a==null?void 0:a.job.payments)||[],N.data.payment]),y(!1)}).catch(N=>{console.log(N)}).finally(()=>{C(!1)}):(console.error("Enter valid amount"),o(0))},ve=()=>{f(!0),j.put(`appointment/${a==null?void 0:a.id}/status`).then(N=>{d(N.data.new_status)}).catch(N=>{console.log(N),H("Something went wrong, please try again")}).finally(()=>{f(!1)})},ye=()=>{const N={timeFrom:O(b),timeTo:O(W),isFinishCurerentAppointment:B,appointmentId:a==null?void 0:a.id};X(!0),j.post(`appointment/copy/${a==null?void 0:a.id}`,N).then(P=>{n(`/appointment/${P.data.appointment.id}`),m(!1)}).catch(P=>{console.log(P),H("Something went wrong, please try again")}).finally(()=>{X(!1),m(!1)})};return l("div",{className:"flex gap-2 md:justify-end justify-around mb-2",children:[e("div",{className:"flex-auto md:flex-none",children:l("button",{onClick:ve,type:"button",className:`btn ${(a==null?void 0:a.status)!==2?"btn-primary":"btn-outline-dark"} h-full text-[13px] px-0 md:px-4 w-full whitespace-nowrap overflow-hidden text-ellipsis`,children:[v?e(Z,{}):l(_,{children:[(a==null?void 0:a.status)===0&&e(Ze,{}),(a==null?void 0:a.status)===1&&e(Ee,{}),(a==null?void 0:a.status)===2&&e(Re,{})]}),(a==null?void 0:a.status)===0&&e("span",{className:"ml-1",children:"On my way"}),(a==null?void 0:a.status)===1&&e("span",{className:"ml-1",children:"Finish Appointment"}),(a==null?void 0:a.status)===2&&e("span",{className:"ml-1",children:"Back to Active"})]})}),e("div",{className:"flex-auto md:flex-none ",children:l("button",{type:"button",onClick:()=>{m(!0)},className:"btn btn-primary h-full text-[13px] px-0 md:px-4 w-full whitespace-nowrap overflow-hidden text-ellipsis",children:[e(Be,{className:"mr-1"}),"Create copy"]})}),e("div",{className:"flex-auto md:flex-none",children:l("button",{type:"button",className:"btn btn-primary h-full text-[13px] px-0 md:px-4 w-full whitespace-nowrap overflow-hidden text-ellipsis",onClick:()=>y(!0),children:[e(He,{className:"mr-1"}),"Pay"]})}),e(L,{appear:!0,show:i,as:s.Fragment,children:l($,{as:"div",open:i,onClose:()=>m(!1),children:[e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{id:"login_modal",className:"fixed inset-0 bg-[black]/60 z-[1111] overflow-y-auto",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e($.Panel,{className:"panel border-0 py-1 rounded-lg overflow-hidden w-full max-w-lg my-8 text-black dark:text-white-dark",children:e("div",{className:"py-4 px-2",children:l("div",{className:"mt-5",children:[l("div",{className:"mb-5 flex justify-center bg-gray-100 dark:bg-white-dark/10 rounded p-2",children:[l("div",{onClick:()=>M("timeFrom"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(F==="timeFrom"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[e("div",{children:"From:"}),l("div",{className:"ml-10 text-center",children:[e("div",{children:A(b,"MMM DD")}),e("div",{children:A(b,"hh:mm A")})]})]}),l("div",{onClick:()=>M("timeTo"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(F==="timeTo"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[e("div",{children:"To:"}),l("div",{className:"ml-10 text-center",children:[e("div",{children:A(W,"MMM DD")}),e("div",{children:A(W,"hh:mm A")})]})]})]}),l("div",{className:"text-[16px] dark:text-white text-right",children:[F==="timeFrom"&&e(K,{currentDate:b,options:{itemsHeight:45,textAlign:"right",borderColor:"#077afe"},onDateChange:ue}),F==="timeTo"&&e(K,{currentDate:W,options:{itemsHeight:45,textAlign:"right",daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe"},onDateChange:fe})]}),e("div",{className:"flex mt-4",children:l("label",{className:"flex items-center cursor-pointer",children:[e("input",{type:"checkbox",className:"form-checkbox",checked:B,onChange:()=>U(N=>!N)}),e("span",{className:" text-white-dark",children:"Finish current appointment"})]})}),e("div",{className:"mt-4",children:l("button",{type:"button",onClick:ye,className:"btn btn-primary w-full",children:["Create new appointment",me&&e(Z,{})]})})]})})})})})})]})}),e(L,{appear:!0,show:u,as:s.Fragment,children:l($,{as:"div",open:u,onClose:()=>y(!1),children:[e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{id:"login_modal",className:"fixed inset-0 bg-[black]/60 z-[1111] overflow-y-auto",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e($.Panel,{className:"panel border-0 py-1 rounded-lg overflow-hidden w-full max-w-lg my-8 text-black dark:text-white-dark",children:l("div",{className:"py-4 px-2",children:[l("div",{className:"title flex justify-between",children:[l("span",{className:"text-danger",children:["Remaining: ",R(r)]}),l("span",{className:"text-success",children:["Total: ",R(h)]})]}),l("div",{className:"input-amount text-center text-5xl py-10",children:["$"," ",e("input",{type:"text",pattern:"\\d*\\.?\\d*",className:"w-[200px] bg-transparent border-b border-gray-700 text-center outline-none",value:w,onChange:pe})]}),l("div",{className:"flex justify-center",children:[r>100&&e("button",{type:"button",onClick:()=>ee("deposit"),className:`btn ${S==="deposit"?"btn-primary":"btn-outline-primary"} mr-4`,children:"Deposit"}),e("button",{type:"button",onClick:()=>ee("full"),className:`btn ${S==="full"?"btn-primary":"btn-outline-primary"}`,children:"Full"})]}),e("div",{className:"payment-methods mt-10",children:e("div",{className:"relative inline-flex w-full align-middle justify-around",children:p.map((N,P)=>e("button",{onClick:()=>k(P),type:"button",className:`btn ${g===P?"btn-primary":"btn-outline-primary"} w-full ${P===0?"rounded-r-none":P===p.length-1?"rounded-l-none":"rounded-none"} `,children:N},P))})}),e("div",{className:"flex mt-10",children:l("label",{className:"flex items-center cursor-pointer",children:[e("input",{type:"checkbox",className:"form-checkbox",checked:Y,onChange:()=>he(N=>!N)}),e("span",{className:" text-white-dark",children:"Send invoice automatically"})]})}),l("div",{className:"flex justify-end items-center mt-4",children:[e("button",{type:"button",onClick:()=>y(!1),className:"btn btn-outline-danger",children:"Discard"}),l("button",{type:"button",onClick:ge,className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:["Pay Now",x&&e(Z,{})]})]})]})})})})})]})})]})},ze=a=>{var k,S,c,w,o,n,i,m,F,M;const d=J(),{appointment:t,updateTags:h}=E(),r=G(b=>b.themeConfig.companyInfo.companyTags),[v,f]=s.useState(!1),[u,y]=s.useState(((k=t==null?void 0:t.job)==null?void 0:k.tags)||null),x=b=>{navigator.clipboard.writeText(b).then(()=>{q("Phone number copied to clipboard")}).catch(D=>{H("Failed to copy phone number")})},C=b=>{navigator.clipboard.writeText(b).then(()=>{q("Address copied to clipboard")}).catch(D=>{H("Failed to copy address")})},p=b=>{u!=null&&u.includes(b)?y(u==null?void 0:u.filter(D=>D.id!==b.id)):y([...u||[],b])},g=()=>{var b;j.post("job/tags/"+((b=t==null?void 0:t.job)==null?void 0:b.id),{tags:u==null?void 0:u.map(D=>D.id)}).then(D=>{D.status===200&&(q("Tags saved successfully"),h(u||[]))}).catch(D=>{H("Failed to save tags")}).finally(()=>{f(!1)})};return l("div",{className:"panel p-0 pb-4",children:[l("div",{className:"flex items-center justify-between p-4",children:[l("h3",{className:"font-semibold text-lg dark:text-white-light",children:[e(V,{to:"/customer/"+((S=t==null?void 0:t.customer)==null?void 0:S.id),className:"hover:underline text-primary",children:(c=t==null?void 0:t.customer)==null?void 0:c.name}),e("span",{className:"ml-4",children:(w=t==null?void 0:t.job)==null?void 0:w.id})]}),e(V,{to:"/customer/update/"+(((o=t==null?void 0:t.customer)==null?void 0:o.id)??0)+"?redirectTo="+window.location.pathname,className:"ltr:ml-auto rtl:mr-auto btn btn-primary p-2 rounded-full",children:e(ie,{className:"w-4 h-4"})})]}),l("div",{className:"mb-1",children:[e("div",{className:"flex flex-col justify-center items-center ",children:e("div",{className:"w-full h-[250px] dark:bg-gray-800 bg-gray-200 flex items-center justify-center",children:"No Location found"})}),e("div",{className:"px-4 pb-4",children:l("ul",{className:"mt-5 flex flex-col m-auto space-y-4 font-semibold dark:text-white-dark",children:[l("li",{className:"flex justify-between",children:[e("div",{className:"flex-1 min-w-0",children:l("div",{className:"flex items-center",children:[e(Ne,{className:"shrink-0"}),e("a",{href:`https://www.google.com/maps?q=${encodeURIComponent(t==null?void 0:t.address)}`,target:"_blank",rel:"noopener noreferrer",className:"whitespace-nowrap overflow-hidden text-ellipsis mx-2",children:t==null?void 0:t.address})]})}),(t==null?void 0:t.address)&&e("button",{onClick:()=>C((t==null?void 0:t.address)||"No data"),children:e(re,{className:"cursor-pointer hover:text-primary"})})]}),l("li",{className:"flex justify-between",children:[l("div",{className:"flex",children:[e(Pe,{}),e("span",{className:"whitespace-nowrap ml-2",children:e("a",{href:`tel:${t==null?void 0:t.customer.phone}`,children:(n=t==null?void 0:t.customer)==null?void 0:n.phone})})]}),(t==null?void 0:t.customer.phone)&&e("button",{onClick:()=>x((t==null?void 0:t.customer.phone)||"No data"),children:e(re,{className:"cursor-pointer hover:text-primary"})})]}),e("li",{children:(i=t==null?void 0:t.customer)!=null&&i.email?l("button",{className:"flex justify-between w-full",onClick:()=>d("/invoice/send/"+(t==null?void 0:t.id)),children:[l("div",{className:"flex",children:[e(se,{className:"w-5 h-5 shrink-0"}),e("span",{className:"truncate ml-2",children:(m=t==null?void 0:t.customer)==null?void 0:m.email})]}),l("div",{className:"flex gap-2 hover:text-primary",children:[e(Ce,{className:"w-5 h-5 shrink-0"}),"Send Invoice"]})]}):l("div",{className:"flex justify-between gap-2",children:[l("div",{className:"flex gap-2",children:[e(se,{className:"w-5 h-5 shrink-0"}),e("span",{className:"truncate",children:"No email"})]}),e(V,{to:"/customer/update/"+(((F=t==null?void 0:t.customer)==null?void 0:F.id)??0)+"?redirectTo="+window.location.pathname,className:"text-primary",children:"Please Add email"})]})}),e("div",{className:"border-t border-[#ebedf2] dark:border-[#191e3a] mt-4"}),l("div",{className:"mt-2 flex justify-between",children:[e("div",{className:"flex flex-wrap gap-2",children:(M=t==null?void 0:t.job)==null?void 0:M.tags.map((b,D)=>e("button",{className:"btn btn-sm border-none text-white shadow-none",style:{backgroundColor:b.color},children:b.title},D))}),e("div",{className:"mt-2 text-right min-w-fit",children:e("span",{className:"text-primary cursor-pointer",onClick:()=>f(!0),children:"+ Add Tag"})})]})]})})]}),e(L,{appear:!0,show:v,as:s.Fragment,children:l($,{as:"div",open:v,onClose:()=>f(!1),children:[e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{id:"login_modal",className:"fixed inset-0 bg-[black]/60 z-[1111] overflow-y-auto",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e($.Panel,{className:"panel border-0 py-1 rounded-lg overflow-hidden w-full max-w-lg my-8 text-black dark:text-white-dark",children:l("div",{className:"py-4 px-2",children:[l("div",{className:"py-4",children:[l("div",{className:"title flex justify-between",children:[e("span",{className:"text-dark dark:text-white-light",children:"Assign Tags"}),e("p",{className:"text-[13px] text-gray-500 dark:text-gray-400",children:"Click on tag to remove it"})]}),e("div",{className:"mt-4",children:e("div",{className:"inline-flex flex-wrap gap-3",children:u==null?void 0:u.map((b,D)=>e("span",{className:"py-1 px-4 text-[13px] rounded-md border cursor-pointer text-black dark:text-white",style:{backgroundColor:b.color,borderColor:b.color},onClick:()=>p(b),children:b.title},D))})})]}),l("div",{className:"border-t border-[#ebedf2] dark:border-[#191e3a] py-4",children:[e("div",{className:"title flex justify-between",children:e("span",{className:"text-dark dark:text-white-light",children:"Choose Tags"})}),l("div",{className:"mt-4",children:[e("div",{className:"inline-flex flex-wrap gap-3",children:r.map(b=>e("span",{className:"py-1 px-4 text-[13px] rounded-md border cursor-pointer text-black dark:text-white",style:{backgroundColor:b.color,borderColor:b.color},onClick:()=>p(b),children:b.title},b.id))}),r.length===0&&l("div",{className:"text-center",children:[e("p",{className:"text-[13px] text-gray-500 dark:text-gray-400",children:"No tags available"}),e(V,{to:"/company-settings/tags",className:"text-primary",children:"Please add new tags"})]})]})]}),l("div",{className:"flex justify-end items-center mt-10",children:[e("button",{type:"button",onClick:()=>f(!1),className:"btn btn-outline-danger",children:"Discard"}),e("button",{onClick:g,type:"button",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"Save"})]})]})})})})})]})})]})},ne=()=>{const{appointment:a,updateTechs:d}=E(),t=(a==null?void 0:a.techs)||[],h=a==null?void 0:a.id,[r,v]=s.useState([]),[f,u]=s.useState([]),[y,x]=s.useState(!1),[C,p]=s.useState(0),[g,k]=s.useState(!1),S=m=>r.includes(m),c=()=>{j.get("company/techs").then(m=>{u(m.data.techs)}).catch(m=>{console.log(m)})},w=()=>{k(!0),j.post(`appointment/tech/${h}`,{techs:r}).then(m=>{console.log(m),m.status===200&&d(f.filter(F=>r.includes(F.id))),x(!1)}).catch(m=>{alert("Something went wrong. Please try again later"),console.log(m)}).finally(()=>{k(!1)})},o=()=>{v(t.map(m=>m.id))},n=m=>{S(m)?v(r.filter(F=>F!==m)):v([...r,m])};return s.useEffect(()=>{c()},[]),s.useEffect(()=>{o()},[t]),l("div",{className:"",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Technical"}),e(Me,{techs:t,modal:y,setModal:x,techsIds:r,companyTechs:f,removeTech:m=>{p(m),j.delete(`appointment/tech/${h}/${m}`).then(F=>{F.status===200&&d(t.filter(M=>M.id!==m))}).catch(F=>{alert("Something went wrong. Please try again later"),console.log(F)}).finally(()=>{p(0)})},removeTechStatus:C,saveNewTechs:w,saveNewTechStatus:g,addRemovetechFromList:n})]})},oe=a=>{var z;const{appointment:d,updateImages:t}=E(),h=d==null?void 0:d.id,[r,v]=s.useState((d==null?void 0:d.images)||[]),[f,u]=s.useState(""),y=s.useRef(null),[x,C]=s.useState([]),[p,g]=s.useState(!1),[k,S]=s.useState(0),[c,w]=s.useState(0),[o,n]=s.useState([]);s.useEffect(()=>{F()},[x]);const i=T=>{C([...T.target.files])},m=()=>{y.current&&!f&&y.current.click()},F=async()=>{if(x.length!=0)try{for(let T=0;T<x.length;T++){let I=x[T];u(`${T+1}/${x.length} uploading...`);const B=new FormData;B.append("image",I);try{const U=await j.post("appointment/images/"+h,B,{headers:{"Content-Type":"multipart/form-data"},maxContentLength:10485760});console.log("File uploaded successfully:",U.data),v(Y=>[...Y,U.data.image])}catch{H("Error uploading image")}}console.log("All files uploaded successfully")}catch(T){H("Error uploading one or more files"),console.error("Error uploading one or more files:",T)}finally{u("Uploading completed"),setTimeout(()=>{u("")},2e3),C([])}},M=T=>{console.log("open gallery"),S(T),g(!0)},b=()=>{k<r.length-1?S(k+1):S(0)},D=()=>{k>0?S(k-1):S(r.length-1)},W=T=>{w(T),j.delete("appointment/images/"+(d==null?void 0:d.id)+"/"+T).then(I=>{console.log("Image deleted successfully:",I.data),v(r.filter(B=>B.id!==T))}).catch(I=>{H("Error deleting image"),console.error("Error deleting image:",I)}).finally(()=>{w(0)})};return l(_,{children:[l("div",{className:"flex items-center justify-between px-4 py-2",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Images"}),e("div",{children:o.map((T,I)=>e("div",{children:T},I))}),f&&e("div",{className:"ml-2",children:f}),e("button",{onClick:m,className:"ltr:ml-auto rtl:mr-auto btn btn-primary p-2 rounded-full",children:e(Ae,{className:"w-4 h-4"})}),e("input",{type:"file",ref:y,style:{display:"none"},onChange:i,accept:"image/*",multiple:!0})]}),e("div",{className:"grid grid-cols-4 md:grid-cols-7 gap-3 p-2",children:r.map((T,I)=>l("div",{className:"relative group",children:[c==T.id&&e("div",{className:"absolute z-10 top-0 left-0 w-full h-full flex items-center justify-center",children:e(Q,{})}),c!=T.id&&e("div",{onClick:()=>W(T.id),className:"absolute top-[-1px] right-0 w-full h-[20px] rounded-t-lg bg-gray-950/90 flex justify-center hover:text-danger cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity duration-300 ease-in-out",children:e(ce,{})}),c==T.id&&e("div",{className:"absolute w-full h-full z-10 blur bg-gray-950/50"}),e("img",{src:T.path,className:`w-full cursor-pointer rounded-lg h-20 ${c==T.id?"blur":""}`,onClick:()=>M(I)})]},I))}),p&&l(_,{children:[e("div",{className:"z-60 fixed bottom-0 top-0 left-0 right-0 bg-black bg-opacity-80 "}),e("div",{className:"z-80 fixed top-0 left-0 w-10 md:w-20 h-full cursor-pointer bg-black bg-opacity-80 hover:bg-opacity-100",onClick:D,children:e("div",{className:"flex items-center justify-center h-full",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-9-7 9-7"})})})}),e("div",{className:"z-70 fixed bottom-0 top-0 left-0 right-0",onClick:()=>g(!1),children:e("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e("img",{src:(z=r[k])==null?void 0:z.path,className:"w-full h-full object-cover rounded-lg"})})}),e("div",{className:"z-80 fixed right-0 top-0 w-10 md:w-20 h-full cursor-pointer bg-black bg-opacity-80 hover:bg-opacity-100",onClick:b,children:e("div",{className:"flex items-center justify-center h-full",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})})]})]})},Ue=()=>{const{appointment:a,updateNotes:d}=E(),t=s.useRef(null),h=a==null?void 0:a.notes;a==null||a.id;const[r,v]=s.useState(""),[f,u]=s.useState(!1),[y,x]=s.useState(0),C=G(c=>c.themeConfig.user),p=c=>{v(c.target.value);const w=(c.target.value.match(/\n/g)||[]).length+1;w>4?c.target.rows=4:c.target.rows=w},g=c=>{c.stopPropagation()},k=()=>{u(!0),j.post(`job/notes/${a==null?void 0:a.job_id}`,{text:r}).then(c=>{console.log(c),c.status===200&&(h==null||h.unshift(c.data.note),d(h||[]),t.current&&(t.current.rows=1),v(""))}).catch(c=>{alert("Something went wrong. Please try again later"),console.log(c)}).finally(()=>{u(!1)})},S=c=>{x(c),j.delete(`job/notes/${c}`).then(w=>{w.status===200&&d((h==null?void 0:h.filter(o=>o.id!==c))||[])}).catch(w=>{alert("Something went wrong. Please try again later"),console.log(w)}).finally(()=>{x(0)})};return l("div",{className:"panel p-4 relative",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Notes"}),e(ke,{onWheel:g,className:"pb-10 max-h-[260px] scrollbar-container",children:e("ul",{className:"mt-2",children:h==null?void 0:h.map((c,w)=>l("li",{className:"flex justify-between items-center mb-2 border-b dark:border-gray-800 pb-2",children:[l("div",{className:"",children:[l("div",{className:"creator dark:text-gray-600 text-gray-400",children:[c.creator.name," ",A(c.updated_at,"MMM DD")]}),e("div",{className:"note mt-1 dark:text-gray-300 text-gray-500",dangerouslySetInnerHTML:{__html:c.text.replace(/\n/g,"<br>")}})]}),y===c.id?e(Q,{}):c.creator.id===C.id&&e("div",{className:"",children:e("button",{type:"button",onClick:()=>S(c.id),className:"ml-4",children:e(Se,{})})})]},w))})}),l("div",{className:"flex absolute bottom-2 right-2 left-2",children:[e("textarea",{ref:t,rows:1,value:r,onChange:p,placeholder:"Type note here...",className:"form-textarea ltr:rounded-r-none rtl:rounded-l-none",onKeyDown:c=>{c.key==="Enter"&&c.ctrlKey&&(c.preventDefault(),r.trim()&&k())}}),e("button",{onClick:k,type:"button",className:"btn btn-secondary ltr:rounded-l-none rtl:rounded-r-none",children:f?e(Z,{}):"Save"})]})]})},Ve=a=>{const d="$0.00",{appointment:t}=E(),[h,r]=s.useState((t==null?void 0:t.expenses)||[]),[v,f]=s.useState({title:"",amount:0,id:0}),[u,y]=s.useState(d),[x,C]=s.useState(!1),[p,g]=s.useState(0),k=n=>{const i=parseFloat(n.target.value.replace(/\D/g,""))/100;y(R(i)),f({...v,amount:i})},S=n=>{n.key==="Enter"&&w()},c=n=>{f({...v,[n.target.name]:n.target.value})},w=()=>{x||v.title===""||v.amount===0||(C(!0),j.post(`/appointment/expense/${t==null?void 0:t.job_id}`,v).then(n=>{n.status===200&&(console.log(n.data.expanse),r([...h,n.data.expanse]),f({title:"",amount:0,id:0}),y(d))}).catch(n=>{console.log(n)}).finally(()=>{C(!1)}))},o=n=>{g(n),j.delete(`/appointment/expense/${n}`).then(i=>{i.status===200&&r(h.filter(m=>m.id!==n))}).catch(i=>{console.log(i)}).finally(()=>{g(0)})};return l("div",{className:"panel p-4",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Expense"}),l("div",{className:"flex justify-between mt-4 gap-4",children:[e("div",{className:"w-3/5",children:e("input",{className:"form-input",value:v.title,placeholder:"Part number",name:"title",onChange:c,onKeyDown:S})}),e("div",{className:"",children:e("input",{className:"form-input",value:u,placeholder:"Cost",name:"cost",onChange:k,onKeyDown:S})}),e("div",{className:"",children:e("button",{className:"btn btn-primary",onClick:w,children:x?e(Z,{}):"Add"})})]}),e("div",{className:"mt-4",children:l("div",{className:"grid grid-cols-3 gap-2",children:[e("div",{className:"col-span-2",children:h.map((n,i)=>l("div",{className:"grid grid-cols-4 mt-3 border-b border-gray-700 p-2 rounded",children:[e("div",{className:"text-sm font-semibold col-span-2",children:n.title}),e("div",{className:"text-sm font-semibold text-center",children:R(n.amount)}),e("div",{className:"action flex justify-end",children:e("span",{className:"text-danger cursor-pointer",onClick:()=>o(n.id),children:p===n.id?e(Q,{}):e(ce,{})})})]},i))}),e("div",{className:"flex items-center justify-center j-full mt-2",children:l("div",{className:"text-center",children:[e("p",{className:"text-xl font-bold",children:R(h.reduce((n,i)=>n+parseFloat(i.amount.toString()),0))}),e("p",{children:"total"})]})})]})})]})},Ye=()=>{var w;const{appointment:a,updatePayments:d}=E(),[t,h]=s.useState(!1),r=((w=a==null?void 0:a.job)==null?void 0:w.total_paid)||0,[v,f]=s.useState(r),[u,y]=s.useState("full"),[x,C]=s.useState(!1),p=["Credit","Transfer","Check","Cash"];s.useEffect(()=>{f(r)},[r]);const g=o=>{if(isNaN(o.target.value))return;const n=o.target.value;f(n)},k=()=>{C(!0),j.post(`/appointment/payment/refund/${a==null?void 0:a.job.id}`,{amount:v,payment_type:p[S]}).then(o=>{o.status===200&&d([...(a==null?void 0:a.job.payments)||[],o.data.payment]),h(!1)}).catch(o=>{alert("Something went wrong. Please try again later"),console.log(o)}).finally(()=>{C(!1)})},[S,c]=s.useState(0);return l("div",{children:[e("button",{type:"button",className:"btn btn-outline-dark btn-sm",onClick:()=>h(!0),children:"Issue refund"}),e(L,{appear:!0,show:t,as:s.Fragment,children:l($,{as:"div",open:t,onClose:()=>h(!1),children:[e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{id:"login_modal",className:"fixed inset-0 bg-[black]/60 z-[1111] overflow-y-auto",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e($.Panel,{className:"panel border-0 py-1 rounded-lg overflow-hidden w-full max-w-lg my-8 text-black dark:text-white-dark",children:l("div",{className:"py-4 px-2",children:[e("div",{className:"title flex justify-between",children:l("span",{className:"text-success",children:["Total Paid: ",R(r)]})}),l("div",{className:"input-amount text-center text-5xl py-10",children:["$"," ",e("input",{type:"text",pattern:"\\d*\\.?\\d*",className:"w-[200px] bg-transparent border-b border-gray-700 text-center outline-none",value:v,onChange:g})]}),e("div",{className:"flex justify-center",children:e("button",{type:"button",onClick:()=>y("full"),className:`btn ${u==="full"?"btn-primary":"btn-outline-primary"}`,children:"Full"})}),e("div",{className:"payment-methods mt-10",children:e("div",{className:"relative inline-flex w-full align-middle justify-around",children:p.map((o,n)=>e("button",{onClick:()=>c(n),type:"button",className:`btn ${S===n?"btn-primary":"btn-outline-primary"} w-full ${n===0?"rounded-r-none":n===p.length-1?"rounded-l-none":"rounded-none"} `,children:o},n))})}),l("div",{className:"flex justify-end items-center mt-10",children:[e("button",{type:"button",onClick:()=>h(!1),className:"btn btn-outline-danger",children:"Discard"}),l("button",{type:"button",onClick:k,className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:["Refund Now",x&&e(Z,{})]})]})]})})})})})]})})]})},Oe=()=>{var C;const{appointment:a,updateServices:d}=E(),t=(a==null?void 0:a.job.services)||[],[h,r]=s.useState(!1),[v,f]=s.useState(!1),u=((C=a==null?void 0:a.job)==null?void 0:C.remaining_balance)||0,y=p=>{f(!0),p.id!==0?(console.log("update service:"),j.put(`appointment/service/${a==null?void 0:a.job_id}/${p.id}`,p).then(g=>{if(g.status===200){const k=t.map(S=>S.id===p.id?p:S);d(k),r(!1)}}).catch(g=>{alert("Something went wrong. Please try again later"),console.log(g)}).finally(()=>{f(!1)})):(console.log("store service:"),j.post(`appointment/service/${a==null?void 0:a.job_id}`,p).then(g=>{g.status===200&&(t.push(g.data.service),d(t),r(!1))}).catch(g=>{alert("Something went wrong. Please try again later"),console.log(g)}).finally(()=>{f(!1)}))},x=p=>{j.delete(`appointment/service/${a==null?void 0:a.job_id}/${p}`).then(g=>{g.status===200&&d(t.filter(k=>k.id!==p))}).catch(g=>{g.response.status===403?alert("You are not allowed to delete this service"):alert("Something went wrong. Please try again later"),console.log(g)})};return l("div",{className:"panel",children:[e("div",{className:"flex items-center justify-between",children:e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Services"})}),l("div",{className:"mt-3",children:[e(Ie,{services:t,payments:a==null?void 0:a.job.payments,onRemoveService:x,onSaveService:y,onUpdateService:y,modal:h,loadingStatus:v,isEditble:!0,setModal:r}),l("div",{className:"mt-4 flex justify-between items-center py-4",children:[l("div",{className:"text-sm",children:[u>0&&l("span",{className:"text-danger ml-2",children:["Remaining: ",R(u)]}),u<=0&&t.length>0&&e("span",{className:"text-success ml-2",children:"Paid full"})]}),e(Ye,{})]}),e("div",{className:"table-responsive text-[#515365] dark:text-white-light font-semibold",children:e("table",{className:"whitespace-nowrap",children:e("tbody",{className:"dark:text-white-dark",children:a==null?void 0:a.job.payments.map((p,g)=>l("tr",{children:[e("td",{children:$e(p.created_at).format("MMM DD YYYY h:mm A")}),e("td",{children:p.type_text}),e("td",{children:R(p.amount)})]},g))})})})]})]})},Ke=()=>{const[a,d]=s.useState(!1),{appointment:t,updateTime:h}=E(),[r,v]=s.useState(!1),[f,u]=s.useState("timeFrom"),[y,x]=s.useState(new Date((t==null?void 0:t.start)||new Date)),[C,p]=s.useState(new Date((t==null?void 0:t.end)||new Date(y.getTime()+60*120*1e3))),[g,k]=s.useState(!1),[S,c]=s.useState(!1),w=i=>{x(i),g||p(new Date(i.getTime()+60*120*1e3))},o=i=>{k(!0),p(i)},n=()=>{c(!0),j.put(`/appointment/${t==null?void 0:t.id}`,{timeFrom:O(y),timeTo:O(C)}).then(i=>{h(y.toString(),C.toString()),d(!1)}).catch(i=>{H("Something went wrong"),console.log(i)}).finally(()=>{c(!1)})};return l(_,{children:[l("div",{className:"flex items-center justify-between pb-0 md:pb-4",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Time"}),e("button",{className:"btn btn-primary p-2 rounded-full",onClick:()=>d(!0),children:e(ie,{className:"w-4 h-4"})})]}),l("div",{className:"timeline",children:[e("div",{className:"max-w-[300px] mx-auto",children:t==null?void 0:t.job.appointments.slice(0,r?t.job.appointments.length:3).map((i,m)=>{var F,M;return e(V,{to:`/appointment/${i.id}`,children:l("div",{className:`flex ${t.id!==i.id?"opacity-50":""}`,children:[e("p",{className:`text-[#3b3f5c] dark:text-white-light w-[120px] ${t.id!==i.id||t.job.appointments.length==1?"text-sm":"text-lg"} font-semibold py-2.5 text-right`,children:A(i==null?void 0:i.start,"DD MMM, YYYY")}),e("div",{className:`relative before:absolute before:top-[15px] before:translate-x-[20px] before:w-2.5 before:h-2.5 before:border-2 before:border-[var(--border-color)] before:rounded-full ${m!==(t==null?void 0:t.job.appointments.length)-1?"after:absolute  after:translate-x-[24px] after:top-[25px] after:-bottom-[15px] after:w-0 after:h-auto after:border-l-2 after:border-[var(--border-color)] after:rounded-full":""}`,style:{"--before-border-color":((F=i.techs)==null?void 0:F.length)>0?i.techs[i.techs.length-1].color:"#1565C0","--after-border-color":((M=i.techs)==null?void 0:M.length)>0?i.techs[i.techs.length-1].color:"#1565C0"}}),e("div",{className:"p-2.5 self-center ml-9 mr-2.5 w-[110px]",children:e("p",{className:`text-[#3b3f5c] dark:text-white-light font-semibold ${t.id!==i.id||t.job.appointments.length==1?"text-sm":"text-lg"}`,children:A(i==null?void 0:i.start,"hh:mm A")})})]},m)},m)})}),!r&&(t==null?void 0:t.job.appointments.length)>3&&e("div",{className:"cursor-pointer text-center mt-4 text-primary",onClick:()=>v(!r),children:"show all"}),e("style",{children:`
               .relative::before {
                  border-color: var(--before-border-color, #1565C0);
               }
               .relative::after {
                  border-color: var(--after-border-color, #1565C0);
               }
            `})]}),e(L,{appear:!0,show:a,as:s.Fragment,children:l($,{as:"div",open:a,onClose:()=>d(!1),children:[e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{id:"login_modal",className:"fixed inset-0 bg-[black]/60 z-[999] overflow-y-auto",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(L.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e($.Panel,{className:"panel border-0 py-6 px-4 rounded-lg overflow-hidden w-full max-w-lg mt-10  text-black dark:text-white-dark",children:l("div",{className:"p-2 md:p-4",children:[l("div",{className:"mt-1",children:[l("div",{className:"mb-5 flex justify-center bg-gray-100 dark:bg-white-dark/10 rounded p-2",children:[l("div",{onClick:()=>u("timeFrom"),className:"w-1/2 timeFrom flex justify-between items-center cursor-pointer py-3 px-2 rounded "+(f==="timeFrom"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[e("div",{children:"From:"}),l("div",{className:"text-center",children:[e("div",{children:A(y,"MMM DD")}),e("div",{children:A(y,"hh:mm A")})]})]}),l("div",{onClick:()=>u("timeTo"),className:"w-1/2 timeFrom flex justify-between items-center cursor-pointer py-3 px-2 rounded "+(f==="timeTo"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[e("div",{children:"To:"}),l("div",{className:"text-center",children:[e("div",{children:A(C,"MMM DD")}),e("div",{children:A(C,"hh:mm A")})]})]})]}),l("div",{className:"text-[16px] dark:text-white-light",children:[f==="timeFrom"&&e(K,{currentDate:y,options:{itemsHeight:45,daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe"},onDateChange:w}),f==="timeTo"&&e(K,{currentDate:C,options:{itemsHeight:45,daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe"},onDateChange:o})]})]}),e("div",{className:"flex justify-center mt-4",children:l("button",{onClick:n,className:"btn btn-primary w-full",children:["Update",S&&e(Z,{})]})})]})})})})})]})})]})},Ge=()=>{const a=J(),d=G(x=>x.themeConfig.user);console.log(d.roles);const[t,h]=s.useState(!1),{appointment:r,fetchAppointmentData:v,loadingStatus:f}=E(),{id:u}=Te(),y=()=>{window.confirm("Are you sure you want to cancel this appointment?")&&(t||(h(!0),j.delete(`/appointment/${r==null?void 0:r.id}`).then(x=>{x.status===200&&a("/schedule")}).catch(x=>{console.log(x),alert("Something went wrong")}).finally(()=>{h(!1)})))};return s.useEffect(()=>{v(parseInt(u||"0"))},[u]),l(_,{children:[f==="loading"&&e(Fe,{}),f==="error"&&e(je,{}),f==="success"&&l(_,{children:[e(We,{}),l("div",{className:"py-4",children:[l("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[l("div",{className:"grid grid-rows-none gap-5",children:[e("div",{className:"panel p-4",children:e(Ke,{})}),e("div",{className:"panel p-4 hidden md:block",children:e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Something new in future"})})]}),l("div",{className:"md:col-span-3 grid grid-cols-1 xl:grid-cols-2 gap-5",children:[l("div",{className:"grid grid-cols-1 gap-5",children:[e(ze,{}),e("div",{className:"panel p-4 hidden md:block",children:e(ne,{})}),e("div",{className:"panel p-0 hidden md:block",children:e(oe,{appointmentId:r==null?void 0:r.id})})]}),l("div",{className:"grid grid-cols-1 gap-5",children:[e(Oe,{}),e(Ve,{}),e(Ue,{}),e("div",{className:"panel p-4 block md:hidden",children:e(ne,{})}),e("div",{className:"panel p-0 block md:hidden",children:e(oe,{appointmentId:r==null?void 0:r.id})})]})]})]}),(d.roles.includes(3)||d.roles.includes(1))&&e("div",{className:"text-center mt-6",children:e("div",{className:"text-danger cursor-pointer",onClick:y,children:t?"Canceling...":"Cancel Appointment"})})]})]})]})},lt=()=>{const[a,d]=s.useState({}),t=De();return s.useEffect(()=>{t(Le("Appointment"))}),e("div",{children:e(_e,{appointmentData:a,children:e(Ge,{})})})};export{lt as default};
