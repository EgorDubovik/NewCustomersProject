import{r as o,a as l,j as y,L as E,g as A,e as W,u as F,h as Y,i as j,s as I,b as V,k as $,l as B,m as z,P as _,c as U,n as G}from"./index-6be21f06.js";const q=e=>{const n=e.appointmentTiles||[],t=e.daysArray||[],a=e.defaultAppointmentOpacity,i=e.defaultAppointmentBgColor,s=e.timesArray||[];e.totalDuration;const r=e.blockHeight||50;e.onAppointmentClick;const d=e.setAppointmentStyle||null,m=o.useRef(null);o.useRef(0),o.useRef(0),o.useRef(!1),o.useRef(0),o.useRef(0),o.useRef(0),o.useRef(null),o.useRef(0),o.useRef(0),o.useRef(0),o.useRef(0),o.useRef(0),o.useRef(!1);const c=h=>{},w=()=>{},p=h=>{let f={backgroundColor:h.appointment.backgroundColor??i,inset:"1px",opacity:h.appointment.opacity??a},g={color:"#fff"},T={},D={};return d&&({extendedBackgroundStyles:T,extendedTitleStyle:D}=d(h.appointment)),f={...f,...T},g={...g,...D},{backgroundStyles:f,titleStyles:g}};return l("div",{className:"dates grid  w-full",style:{gridTemplateColumns:`repeat(${t.length}, minmax(0, 1fr))`},children:t.map((h,f)=>l("div",{className:"date pt-2 first:border-0 border-l dark:border-gray-600 border-gray-300",children:y("div",{className:"day-inner relative h-full",ref:m,children:[l("div",{className:"appointments-list overflow-hidden absolute h-full left-0 top-0 right-0",onMouseUp:w,onMouseMove:c,children:n[f]&&n[f].map((g,T)=>y(E,{to:`/appointment/${g.appointment.id}`,className:"appointment text-[.8em]  absolute p-[2px] cursor-pointer",style:{height:g.height+"%",width:g.width+"%",left:g.left+"%",top:g.top+"%"},children:[l("div",{className:"appointment-conteiner rounded absolute",style:p(g).backgroundStyles}),l("div",{className:"sticky font-bold",style:p(g).titleStyles,children:l("div",{className:"appointment-title px-2 pt-1 hover:underline ",children:g.appointment.title})})]},g.appointment.title+"-"+T+g.top))}),s.map((g,T)=>l("div",{className:"date-time dark:border-gray-600 border-gray-300 border-t",style:{height:r+"px"}},T))]})},f))})},J=e=>{const{blockHeight:n,timesArray:t}=e;return l("div",{className:"times text-[0.8em] w-10 pt-2",children:t.map((a,i)=>l("div",{className:"time  border-t border-transparent",style:{height:n+"px"},children:l("div",{className:"time-title  -mt-2",children:a})},i))})},H=e=>{const n=new Date;let t=0,a=0;const i=e.match(/^(\d{1,2})\s?(am|pm)$/i);i&&(t=parseInt(i[1]),i[2].toLowerCase()==="pm"&&t!==12&&(t+=12),i[2].toLowerCase()==="am"&&t===12&&(t=0));const s=e.match(/^(\d{1,2}):(\d{2})$/);return s&&(t=parseInt(s[1]),a=parseInt(s[2])),new Date(n.getFullYear(),n.getMonth(),n.getDate(),t,a,0)},R=(e,n)=>{const t=new Date(e);return t.setTime(t.getTime()+n*24*60*60*1e3),t},O=(e,n)=>{const t=new Date(e);return t.setTime(t.getTime()+n*7*24*60*60*1e3),t},K=(e,n,t,a)=>{const i=r=>{const d=r.getDay(),m=r.getDate()-d+(d===0?-6:1);return new Date(r.setDate(m))},s=(r,d)=>{const m=new Date(r);return m.setHours(d.getHours(),d.getMinutes(),0,0),m};if(a==="week"){const r=i(e),d=new Date(r);return d.setDate(r.getDate()+6),{start:s(r,n),end:s(d,t)}}else if(a==="day")return{start:s(e,n),end:s(e,t)}},Q=(e,n,t,a)=>{const i=new Date(e.getTime()),s=new Date(n.getTime()),r=[];for(i.getTime()===s.getTime()&&s.setDate(s.getDate()+1);i<=s;)r.push(A(i,t)),i.setHours(i.getHours()+a);return r},X=(e,n)=>{const t=[],a=new Date,i=new Date(e.getTime()),s=i.getDay(),r=(s===0?-6:1)-s;if(i.setDate(i.getDate()+r),n==="day")return[{title:A(e,"DDD DD"),isSelect:e.getFullYear()===a.getFullYear()&&e.getMonth()===a.getMonth()&&e.getDate()===a.getDate(),date:e}];for(let d=0;d<7;d++){const m=A(i,"DDD DD");t.push({title:m,isSelect:i.getFullYear()===a.getFullYear()&&i.getMonth()===a.getMonth()&&i.getDate()===a.getDate(),date:new Date(i.getTime())}),i.setDate(i.getDate()+1)}return t},Z=(e,n,t)=>e.filter(s=>(s.start=new Date(s.start),s.end=new Date(s.end),s.start.getTime()>=n.getTime()&&s.start.getTime()<=t.getTime()||s.end.getTime()>=n.getTime()&&s.end.getTime()<=t.getTime()||s.start.getTime()<n.getTime()&&s.end.getTime()>t.getTime())).sort((s,r)=>r.start-s.start),ee=(e,n,t)=>{const a=new Date(n.getTime()),i=new Date(t.getTime());let s=new Array;for(;a.getTime()<i.getTime();){const r=new Date(a.getTime());r.setHours(i.getHours());const d=e.filter(c=>{const w=typeof c.start=="string"?new Date(c.start):c.start,p=typeof c.end=="string"?new Date(c.end):c.end;return w.getTime()>=a.getTime()&&w.getTime()<r.getTime()||p.getTime()>a.getTime()&&p.getTime()<=r.getTime()||w.getTime()<a.getTime()&&p.getTime()>r.getTime()});let m=[];d.forEach(c=>{const{top:w,height:p}=te(a,r,c.start,c.end);let h={start:c.start,end:c.end,appointment:c,top:w,left:null,width:null,height:p};m.push(h)});for(let c=0;c<m.length;c++)P(m[c],m);for(let c=0;c<m.length;c++)P(m[c],m);s.push(m),a.setDate(a.getDate()+1)}return s},te=(e,n,t,a)=>{const i=(n.getTime()-e.getTime())/1e3/60+60,s=t.getTime()<e.getTime()?0:(t.getTime()-e.getTime())/1e3/60,d=(a.getTime()>n.getTime()?i:(a.getTime()-e.getTime())/1e3/60)-s,m=s/i*100,c=d/i*100;return{top:m,height:c}},P=(e,n)=>{const t=ne(e,n);if(t.length===0){e.left=0,e.width=100;return}const a=se(t);if(a)e.left=a.left,e.width=a.width;else{t.push(e);const i=100/t.length;t.forEach((s,r)=>{s.left=r*i,s.width=i})}},ne=(e,n)=>n.filter(t=>e===t?!1:e.start.getTime()>=t.start.getTime()&&e.start.getTime()<t.end.getTime()||e.end.getTime()>t.start.getTime()&&e.end.getTime()<=t.end.getTime()||e.start.getTime()<t.start.getTime()&&e.end.getTime()>t.end.getTime()),se=e=>{e.sort((t,a)=>(t.left??0)-(a.left??0));let n=0;for(const t of e)if(t.left!==null){if(t.left>n)return{left:n,width:t.left-n};n=Math.max(n,t.left+(t.width??0))}return n<100?{left:n,width:100-n}:null},ae=e=>{const{selectedDay:n,daysArray:t}=e;return y("div",{className:"scheduler-weekdays flex mt-2 border-b dark:border-gray-600 border-gray-300",children:[l("div",{className:"first-item w-10"}),l("div",{className:"weekdays text-center grid w-full",style:{gridTemplateColumns:`repeat(${t.length}, minmax(0, 1fr))`},children:t.map((a,i)=>l("div",{className:`weekday py-2 ${a.isSelect?"dark:bg-blue-900 bg-blue-300 rounded-t dark:text-white text-black":""}`,children:a.title},i))},t.length)]})},ie=e=>{const n=o.useMemo(()=>H(e.startTime||"00:00"),[e.startTime]),t=o.useMemo(()=>H(e.endTime||"23:00"),[e.endTime]),a=o.useMemo(()=>e.onClickHandler||null,[e.onClickHandler]),i=o.useMemo(()=>e.setAppointmentStyle||null,[e.setAppointmentStyle]),s=o.useMemo(()=>e.onCurrentDateChange||null,[e.onCurrentDateChange]),r=e.viewType||"week",d=e.blockHeight||50,m=e.defaultAppointmentOpacity||.8,c=e.isHeader!==void 0?e.isHeader:!0,w=e.isDaysNames!==void 0?e.isDaysNames:!0,p=new Date,[h,f]=o.useState(new Date);o.useEffect(()=>{f(e.currentDate?new Date(e.currentDate):new Date)},[e.currentDate]);const[g,T]=o.useState(new Date),[D,N]=o.useState(new Date);o.useEffect(()=>{const M=K(h,n,t,r);M&&(T(M.start),N(M.end)),s&&s(h)},[h,n,t,r]);const C=Q(n,t,"hh A",1),x=X(h,r),S=o.useMemo(()=>Z(e.appointments||[],g,D),[e.appointments,g,D]),u=o.useMemo(()=>ee(S,g,D),[S]),b=e.defaultAppointmentBgColor||"#1565c0",v=()=>{r==="week"&&f(O(h,-1)),r==="day"&&f(R(h,-1))},k=()=>{r==="week"&&f(O(h,1)),r==="day"&&f(R(h,1))},L=()=>{f(p)};return l("div",{className:"select-none",children:y("div",{className:"scheduler-container dark:bg-black rounded p-4",children:[c&&y("div",{className:"scheduler-header flex justify-between",children:[l("div",{className:"scheduler-date text-base",children:A(h,"MMMM YYYY")}),y("div",{className:"scheduler-nav flex gap-4",children:[l("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:v,children:"<"}),l("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:L,children:"Today"}),l("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:k,children:">"})]})]}),y("div",{className:"scheduler-body",children:[w&&l(ae,{selectedDay:h,daysArray:x}),y("div",{className:"scheduler-dates flex relative",children:[l(J,{timesArray:C,blockHeight:d}),l(q,{blockHeight:d,startTime:n,endTime:t,timesArray:C,daysArray:x,appointmentTiles:u,onAppointmentClick:a,defaultAppointmentOpacity:m,defaultAppointmentBgColor:b,setAppointmentStyle:i})]})]})]})})},le=()=>{const e=W(),n=F(),[t,a]=o.useState([]),[i,s]=o.useState("day"),r=Y(u=>u.themeConfig.theme),[d,m]=j(),[c,w]=o.useState(new Date),[p,h]=o.useState(!1),[f,g]=o.useState(0);o.useEffect(()=>{e(I("Schedule"))});const[T,D]=o.useState("loading");o.useEffect(()=>{D("success"),D("loading"),V.get("/appointment").then(b=>{a(b.data.appointments),g(b.data.appointments.filter(v=>v.status!==2).length),D("success")}).catch(b=>{D("error"),console.log(b)});const u=d.get("currentDate");u&&w(new Date(u))},[]),o.useEffect(()=>{const u=()=>{window.innerWidth<768?s("day"):s("week")};return window.addEventListener("resize",u),u(),()=>{window.removeEventListener("resize",u)}},[]);const N=u=>{n("/appointment/"+u)};return y("div",{className:"relative",children:[l("div",{className:` ${p?"block":"hidden"} transition-opacity duration-300 absolute -top-6 -left-6 w-[250px]  h-full dark:bg-black bg-white z-10 shadow-[5px_0_25px_0_rgba(94,92,154,0.1)] `,children:l("div",{className:"pt-16",children:y("ul",{className:"relative font-semibold space-y-0.5 px-4 pt-4 overflow-y-auto",children:[l("li",{className:"menu nav-item",children:l("a",{href:"/schedule/active/appointments",className:"flex items-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800",children:y("div",{className:"flex items-center justify-between w-full",children:[y("div",{className:"flex items-center",children:[l($,{className:"mr-1"}),"Active Appointments"]}),l("div",{className:"w-5 h-5 bg-red-500 ml-4 p-2 text-white rounded-full flex items-center justify-center",children:f})]})})}),l("li",{className:"menu nav-item",children:l("a",{href:"/schedule/maps/todays",className:"flex items-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800",children:l("div",{className:"flex items-center justify-between w-full",children:y("div",{className:"flex items-center",children:[l(B,{className:"mr-1"}),"Map View"]})})})})]})})}),l("div",{className:"flex items-center justify-between flex-wrap gap-4",children:y("div",{className:"flex items-center z-20 cursor-pointer",onClick:()=>h(!p),children:[l("div",{className:"",children:l(z,{className:"mr-2"})}),l("h2",{className:"text-xl",children:"Schedule"})]})}),T==="loading"&&l(_,{}),T==="error"&&l(U,{}),T==="success"&&l("div",{className:"py-4",children:l(ie,{onCurrentDateChange:u=>{console.log(u),d.set("currentDate",u.toISOString()),m(d)},startTime:"07:00",endTime:"20:00",currentDate:c,viewType:i,appointments:t,onClickHandler:u=>{N(u.id)},setAppointmentStyle:u=>{let b={},v={};console.log("app title:",u.title);const k=G(u);return b={backgroundColor:k},u.status===2&&(console.log("app status:",u.status),b={backgroundColor:r==="dark"?"#4a4a4ab0":"#ccc",borderLeft:"3px solid "+k},v={color:r==="dark"?"#ffffff":"#000000"}),{extendedBackgroundStyles:b,extendedTitleStyle:v}}})})]})};export{le as default};
