import{r as l,a as r,j as y,L as E,h as A,u as W,d as F,i as Y,k as j,f as I,b as V,l as $,m as B,n as z,P as _,c as U,o as G}from"./index-2d8ba8ea.js";const q=e=>{const n=e.appointmentTiles||[],t=e.daysArray||[],a=e.defaultAppointmentOpacity,i=e.defaultAppointmentBgColor,s=e.timesArray||[];e.totalDuration;const o=e.blockHeight||50;e.onAppointmentClick;const d=e.setAppointmentStyle||null,m=l.useRef(null);l.useRef(0),l.useRef(0),l.useRef(!1),l.useRef(0),l.useRef(0),l.useRef(0),l.useRef(null),l.useRef(0),l.useRef(0),l.useRef(0),l.useRef(0),l.useRef(0),l.useRef(!1);const c=g=>{},T=()=>{},p=g=>{let f={backgroundColor:g.appointment.backgroundColor??i,inset:"1px",opacity:g.appointment.opacity??a},u={color:"#fff"},w={},D={};return d&&({extendedBackgroundStyles:w,extendedTitleStyle:D}=d(g.appointment)),f={...f,...w},u={...u,...D},{backgroundStyles:f,titleStyles:u}};return r("div",{className:"dates grid  w-full",style:{gridTemplateColumns:`repeat(${t.length}, minmax(0, 1fr))`},children:t.map((g,f)=>r("div",{className:"date pt-2 first:border-0 border-l dark:border-gray-600 border-gray-300",children:y("div",{className:"day-inner relative h-full",ref:m,children:[r("div",{className:"appointments-list overflow-hidden absolute h-full left-0 top-0 right-0",onMouseUp:T,onMouseMove:c,children:n[f]&&n[f].map((u,w)=>y(E,{to:`/appointment/${u.appointment.id}`,className:"appointment text-[.8em]  absolute p-[2px] cursor-pointer",style:{height:u.height+"%",width:u.width+"%",left:u.left+"%",top:u.top+"%"},children:[r("div",{className:"appointment-conteiner rounded absolute",style:p(u).backgroundStyles}),r("div",{className:"sticky font-bold",style:p(u).titleStyles,children:r("div",{className:"appointment-title px-2 pt-1 hover:underline ",children:u.appointment.title})}),u.appointment.paymentPending&&r("div",{className:"absolute right-2 bottom-2 w-2 h-2 bg-red-500 rounded-full"})]},u.appointment.title+"-"+w+u.top))}),s.map((u,w)=>r("div",{className:"date-time dark:border-gray-600 border-gray-300 border-t",style:{height:o+"px"}},w))]})},f))})},J=e=>{const{blockHeight:n,timesArray:t}=e;return r("div",{className:"times text-[0.8em] w-10 pt-2",children:t.map((a,i)=>r("div",{className:"time  border-t border-transparent",style:{height:n+"px"},children:r("div",{className:"time-title  -mt-2",children:a})},i))})},H=e=>{const n=new Date;let t=0,a=0;const i=e.match(/^(\d{1,2})\s?(am|pm)$/i);i&&(t=parseInt(i[1]),i[2].toLowerCase()==="pm"&&t!==12&&(t+=12),i[2].toLowerCase()==="am"&&t===12&&(t=0));const s=e.match(/^(\d{1,2}):(\d{2})$/);return s&&(t=parseInt(s[1]),a=parseInt(s[2])),new Date(n.getFullYear(),n.getMonth(),n.getDate(),t,a,0)},R=(e,n)=>{const t=new Date(e);return t.setTime(t.getTime()+n*24*60*60*1e3),t},P=(e,n)=>{const t=new Date(e);return t.setTime(t.getTime()+n*7*24*60*60*1e3),t},K=(e,n,t,a)=>{const i=o=>{const d=o.getDay(),m=o.getDate()-d+(d===0?-6:1);return new Date(o.setDate(m))},s=(o,d)=>{const m=new Date(o);return m.setHours(d.getHours(),d.getMinutes(),0,0),m};if(a==="week"){const o=i(e),d=new Date(o);return d.setDate(o.getDate()+6),{start:s(o,n),end:s(d,t)}}else if(a==="day")return{start:s(e,n),end:s(e,t)}},Q=(e,n,t,a)=>{const i=new Date(e.getTime()),s=new Date(n.getTime()),o=[];for(i.getTime()===s.getTime()&&s.setDate(s.getDate()+1);i<=s;)o.push(A(i,t)),i.setHours(i.getHours()+a);return o},X=(e,n)=>{const t=[],a=new Date,i=new Date(e.getTime()),s=i.getDay(),o=(s===0?-6:1)-s;if(i.setDate(i.getDate()+o),n==="day")return[{title:A(e,"DDD DD"),isSelect:e.getFullYear()===a.getFullYear()&&e.getMonth()===a.getMonth()&&e.getDate()===a.getDate(),date:e}];for(let d=0;d<7;d++){const m=A(i,"DDD DD");t.push({title:m,isSelect:i.getFullYear()===a.getFullYear()&&i.getMonth()===a.getMonth()&&i.getDate()===a.getDate(),date:new Date(i.getTime())}),i.setDate(i.getDate()+1)}return t},Z=(e,n,t)=>e.filter(s=>(s.start=new Date(s.start),s.end=new Date(s.end),s.start.getTime()>=n.getTime()&&s.start.getTime()<=t.getTime()||s.end.getTime()>=n.getTime()&&s.end.getTime()<=t.getTime()||s.start.getTime()<n.getTime()&&s.end.getTime()>t.getTime())).sort((s,o)=>o.start-s.start),ee=(e,n,t)=>{const a=new Date(n.getTime()),i=new Date(t.getTime());let s=new Array;for(;a.getTime()<i.getTime();){const o=new Date(a.getTime());o.setHours(i.getHours());const d=e.filter(c=>{const T=typeof c.start=="string"?new Date(c.start):c.start,p=typeof c.end=="string"?new Date(c.end):c.end;return T.getTime()>=a.getTime()&&T.getTime()<o.getTime()||p.getTime()>a.getTime()&&p.getTime()<=o.getTime()||T.getTime()<a.getTime()&&p.getTime()>o.getTime()});let m=[];d.forEach(c=>{const{top:T,height:p}=te(a,o,c.start,c.end);let g={start:c.start,end:c.end,appointment:c,top:T,left:null,width:null,height:p};m.push(g)});for(let c=0;c<m.length;c++)O(m[c],m);for(let c=0;c<m.length;c++)O(m[c],m);s.push(m),a.setDate(a.getDate()+1)}return s},te=(e,n,t,a)=>{const i=(n.getTime()-e.getTime())/1e3/60+60,s=t.getTime()<e.getTime()?0:(t.getTime()-e.getTime())/1e3/60,d=(a.getTime()>n.getTime()?i:(a.getTime()-e.getTime())/1e3/60)-s,m=s/i*100,c=d/i*100;return{top:m,height:c}},O=(e,n)=>{const t=ne(e,n);if(t.length===0){e.left=0,e.width=100;return}const a=se(t);if(a)e.left=a.left,e.width=a.width;else{t.push(e);const i=100/t.length;t.forEach((s,o)=>{s.left=o*i,s.width=i})}},ne=(e,n)=>n.filter(t=>e===t?!1:e.start.getTime()>=t.start.getTime()&&e.start.getTime()<t.end.getTime()||e.end.getTime()>t.start.getTime()&&e.end.getTime()<=t.end.getTime()||e.start.getTime()<t.start.getTime()&&e.end.getTime()>t.end.getTime()),se=e=>{e.sort((t,a)=>(t.left??0)-(a.left??0));let n=0;for(const t of e)if(t.left!==null){if(t.left>n)return{left:n,width:t.left-n};n=Math.max(n,t.left+(t.width??0))}return n<100?{left:n,width:100-n}:null},ae=e=>{const{selectedDay:n,daysArray:t}=e;return y("div",{className:"scheduler-weekdays flex mt-2 border-b dark:border-gray-600 border-gray-300",children:[r("div",{className:"first-item w-10"}),r("div",{className:"weekdays text-center grid w-full",style:{gridTemplateColumns:`repeat(${t.length}, minmax(0, 1fr))`},children:t.map((a,i)=>r("div",{className:`weekday py-2 ${a.isSelect?"dark:bg-blue-900 bg-blue-300 rounded-t dark:text-white text-black":""}`,children:a.title},i))},t.length)]})},ie=e=>{const n=l.useMemo(()=>H(e.startTime||"00:00"),[e.startTime]),t=l.useMemo(()=>H(e.endTime||"23:00"),[e.endTime]),a=l.useMemo(()=>e.onClickHandler||null,[e.onClickHandler]),i=l.useMemo(()=>e.setAppointmentStyle||null,[e.setAppointmentStyle]),s=l.useMemo(()=>e.onCurrentDateChange||null,[e.onCurrentDateChange]),o=e.viewType||"week",d=e.blockHeight||50,m=e.defaultAppointmentOpacity||.8,c=e.isHeader!==void 0?e.isHeader:!0,T=e.isDaysNames!==void 0?e.isDaysNames:!0,p=new Date,[g,f]=l.useState(new Date);l.useEffect(()=>{f(e.currentDate?new Date(e.currentDate):new Date)},[e.currentDate]);const[u,w]=l.useState(new Date),[D,N]=l.useState(new Date);l.useEffect(()=>{const M=K(g,n,t,o);M&&(w(M.start),N(M.end)),s&&s(g)},[g,n,t,o]);const C=Q(n,t,"hh A",1),S=X(g,o),x=l.useMemo(()=>Z(e.appointments||[],u,D),[e.appointments,u,D]),h=l.useMemo(()=>ee(x,u,D),[x]),b=e.defaultAppointmentBgColor||"#1565c0",v=()=>{o==="week"&&f(P(g,-1)),o==="day"&&f(R(g,-1))},k=()=>{o==="week"&&f(P(g,1)),o==="day"&&f(R(g,1))},L=()=>{f(p)};return r("div",{className:"select-none",children:y("div",{className:"scheduler-container dark:bg-black rounded p-4",children:[c&&y("div",{className:"scheduler-header flex justify-between",children:[r("div",{className:"scheduler-date text-base",children:A(g,"MMMM YYYY")}),y("div",{className:"scheduler-nav flex gap-4",children:[r("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:v,children:"<"}),r("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:L,children:"Today"}),r("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:k,children:">"})]})]}),y("div",{className:"scheduler-body",children:[T&&r(ae,{selectedDay:g,daysArray:S}),y("div",{className:"scheduler-dates flex relative",children:[r(J,{timesArray:C,blockHeight:d}),r(q,{blockHeight:d,startTime:n,endTime:t,timesArray:C,daysArray:S,appointmentTiles:h,onAppointmentClick:a,defaultAppointmentOpacity:m,defaultAppointmentBgColor:b,setAppointmentStyle:i})]})]})]})})},oe=()=>{const e=W(),n=F(),[t,a]=l.useState([]),[i,s]=l.useState("day"),o=Y(h=>h.themeConfig.theme),[d,m]=j(),[c,T]=l.useState(new Date),[p,g]=l.useState(!1),[f,u]=l.useState(0);l.useEffect(()=>{e(I("Schedule"))});const[w,D]=l.useState("loading");l.useEffect(()=>{D("success"),D("loading"),V.get("/appointment").then(b=>{console.log("Schedule:",b.data.appointments),a(b.data.appointments),u(b.data.appointments.filter(v=>v.status!==2).length),D("success")}).catch(b=>{D("error"),console.log(b)});const h=d.get("currentDate");h&&T(new Date(h))},[]),l.useEffect(()=>{const h=()=>{window.innerWidth<768?s("day"):s("week")};return window.addEventListener("resize",h),h(),()=>{window.removeEventListener("resize",h)}},[]);const N=h=>{n("/appointment/"+h)};return y("div",{className:"relative",children:[r("div",{className:` ${p?"block":"hidden"} transition-opacity duration-300 absolute -top-6 -left-6 w-[250px]  h-full dark:bg-black bg-white z-10 shadow-[5px_0_25px_0_rgba(94,92,154,0.1)] `,children:r("div",{className:"pt-16",children:y("ul",{className:"relative font-semibold space-y-0.5 px-4 pt-4 overflow-y-auto",children:[r("li",{className:"menu nav-item",children:r("a",{href:"/schedule/active/appointments",className:"flex items-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800",children:y("div",{className:"flex items-center justify-between w-full",children:[y("div",{className:"flex items-center",children:[r($,{className:"mr-1"}),"Active Appointments"]}),r("div",{className:"w-5 h-5 bg-red-500 ml-4 p-2 text-white rounded-full flex items-center justify-center",children:f})]})})}),r("li",{className:"menu nav-item",children:r("a",{href:"/schedule/maps/todays",className:"flex items-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800",children:r("div",{className:"flex items-center justify-between w-full",children:y("div",{className:"flex items-center",children:[r(B,{className:"mr-1"}),"Map View"]})})})})]})})}),r("div",{className:"flex items-center justify-between flex-wrap gap-4",children:y("div",{className:"flex items-center z-20 cursor-pointer",onClick:()=>g(!p),children:[r("div",{className:"",children:r(z,{className:"mr-2"})}),r("h2",{className:"text-xl",children:"Schedule"})]})}),w==="loading"&&r(_,{}),w==="error"&&r(U,{}),w==="success"&&r("div",{className:"py-4",children:r(ie,{onCurrentDateChange:h=>{console.log(h),d.set("currentDate",h.toISOString()),m(d)},startTime:"07:00",endTime:"20:00",currentDate:c,viewType:i,appointments:t,onClickHandler:h=>{N(h.id)},setAppointmentStyle:h=>{let b={},v={};const k=G(h);return b={backgroundColor:k},h.status===2&&(b={backgroundColor:o==="dark"?"#4a4a4ab0":"#ccc",borderLeft:"3px solid "+k},v={color:o==="dark"?"#ffffff":"#000000"}),{extendedBackgroundStyles:b,extendedTitleStyle:v}}})})]})};export{oe as default};
