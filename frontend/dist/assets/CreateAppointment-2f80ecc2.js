import{r as s,a as t,F as Z,b as L,u as _,h as ee,G as te,j as a,P as se,c as ae,B as re,x as oe,y as H}from"./index-b9288a7c.js";import{a as ne,T as B,S as ie}from"./ServicesList-23a4d825.js";import{h as x}from"./moment-a9aaa855.js";import{I as ce}from"./IconEdit-6882eaf4.js";import"./IconPlus-8a17f45c.js";import"./IconCopy-1b514e7a.js";const de=y=>{const[N,n]=s.useState(0),[u,d]=s.useState([]),{modal:f,setModal:l,techsIds:m,onAddRemovetechFromList:k,onSaveTeachs:w,onRemoveTech:i}=y,[g,C]=s.useState([]),v=()=>{L.get("company/techs").then(r=>{d(r.data.techs)}).catch(r=>{console.log(r)}).finally(()=>{})};return s.useEffect(()=>{v()},[]),s.useEffect(()=>{C(u.filter(r=>m.includes(r.id))),n(0)},[m,u]),t(Z,{children:t(ne,{techs:g,companyTechs:u,modal:f,setModal:l,techsIds:m,removeTech:r=>{n(r),i(r)},removeTechStatus:N,addRemovetechFromList:r=>{k(r)},saveNewTechs:()=>{w()}})})},ve=()=>{var P;const y=_(),N=()=>{const e=new Date;return e.getMinutes()>45&&e.getMinutes()<=59&&(e.setHours(e.getHours()+1),e.setMinutes(0),e.setSeconds(0)),e},[n,u]=s.useState(N()),[d,f]=s.useState(new Date(new Date().getTime()+60*120*1e3)),[l,m]=s.useState("timeFrom"),[k,w]=s.useState(!1),[i,g]=s.useState([]),[C,v]=s.useState(!1);s.useState(!1);const[p,T]=s.useState(!1),S=s.useRef(null),[r,A]=s.useState(!1),E=ee(e=>e.themeConfig.user.id),[D,F]=s.useState("loading"),[c,R]=s.useState(null),O=e=>{g(i.filter(o=>o.id!==e))},z=e=>{e.id=i.length+1,g([...i,e]),v(!1)},{customerId:j}=te(),[M,G]=s.useState();s.useEffect(()=>{F("loading"),L.get(`customers/${j}`).then(e=>{G({id:e.data.customer.id,name:e.data.customer.name,phone:e.data.customer.phone,addresses:e.data.customer.address}),R(e.data.customer.address[0]||null),F("success")}).catch(e=>{F("error"),console.log(e)})},[]);const $=e=>{console.log("time from:",e),u(new Date(e)),k||f(new Date(e.getTime()+60*120*1e3))},q=e=>{w(!0),f(new Date(e))},[J,I]=s.useState(!1),[h,b]=s.useState([]),K=e=>h.includes(e),Q=e=>{b(h.filter(o=>o!==e))},U=e=>{K(e)?b(h.filter(o=>o!==e)):b([...h,e])},V=()=>{I(!1)};s.useEffect(()=>{b([E])},[E]);const W=e=>{R(e),T(!1)},X=()=>{if(!r){if(!c){oe("Please select an address");return}A(!0),L.post("appointment",{timeFrom:H(n),timeTo:H(d),services:i,techs:h,customerId:j,addressId:c==null?void 0:c.id}).then(e=>{e.status===200&&y("/appointment/"+e.data.appointment.id)}).catch(e=>{console.log(e),alert("Error, please try again")}).finally(()=>{A(!1)})}},Y=()=>{T(e=>!e)};return s.useEffect(()=>{const e=o=>{S.current&&!S.current.contains(o.target)&&T(!1)};return p&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[p]),a("div",{children:[D==="loading"&&t(se,{}),D==="error"&&t(ae,{}),D==="success"&&M&&a("div",{children:[t("div",{className:"flex items-center justify-center flex-wrap gap-4 my-4 md:my-0 md:justify-start",children:t("h2",{className:"text-xl",children:"Create appointment"})}),t("div",{className:"conteiner w-full md:w-1/3 m-auto",children:a("div",{className:"panel",children:[a("div",{className:"mb-5 relative",children:[t("div",{className:"border-b border-[#ebedf2] dark:border-[#1b2e4b] dark:bg-gray-800 px-2 rounded-t",children:a("div",{className:"flex items-center justify-between py-3",children:[a("h6",{className:"text-[#515365] font-bold dark:text-white-dark text-[15px]",children:[M.name,t("span",{className:"block text-white-dark dark:text-white-light font-normal text-xs mt-1",children:(c==null?void 0:c.full)||"No address in customer"})]}),t("div",{className:"h-full p-2 cursor-pointer rounded hover:dark:bg-white-dark/10 hover:bg-gray-100",onClick:()=>Y(),children:t(ce,{})})]})}),t("div",{ref:S,className:"absolute "+(p?"":"hidden")+" left-0 right-0 top-17 bg-gray-100 dark:bg-gray-800 py-4 rounded-b z-50 shadow-lg",children:(P=M.addresses)==null?void 0:P.map((e,o)=>t("div",{className:"address-list p-4 hover:bg-gray-200  hover:dark:bg-gray-900 cursor-pointer",onClick:()=>W(e),children:e.full},o))})]}),a("div",{className:"mt-5",children:[a("div",{className:"mb-5 flex justify-center bg-gray-100 dark:bg-white-dark/10 rounded p-2",children:[a("div",{onClick:()=>m("timeFrom"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(l==="timeFrom"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[t("div",{children:"From:"}),a("div",{className:"ml-10 text-center",children:[t("div",{children:x(n).format("MMM DD")}),t("div",{children:x(n).format("hh:mm A")})]})]}),a("div",{onClick:()=>m("timeTo"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(l==="timeTo"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[t("div",{children:"To:"}),a("div",{className:"ml-10 text-center",children:[t("div",{children:x(d).format("MMM DD")}),t("div",{children:x(d).format("hh:mm A")})]})]})]}),a("div",{className:"text-[16px] dark:text-white text-right",children:[l==="timeFrom"&&t(B,{currentDate:n,options:{itemsHeight:45,textAlign:"right",borderColor:"#077afe"},onDateChange:$}),l==="timeTo"&&t(B,{currentDate:d,options:{itemsHeight:45,daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe"},onDateChange:q})]})]}),a("div",{className:"mt-5",children:[t("h2",{children:"Add services"}),t("div",{className:"mt-5",children:t(ie,{services:i,onRemoveService:O,onSaveService:z,modal:C,setModal:v})})]}),a("div",{className:"mt-5",children:[t("h2",{children:"Add Technical"}),t("div",{className:"mt-5",children:t(de,{techsIds:h,onRemoveTech:Q,modal:J,setModal:I,onAddRemovetechFromList:U,onSaveTeachs:V})})]}),t("div",{className:"mt-8",children:t("button",{onClick:X,className:"btn btn-primary w-full",children:r?a("div",{children:["Loading...",t(re,{})]}):"Create appointment"})})]})})]})]})};export{ve as default};
