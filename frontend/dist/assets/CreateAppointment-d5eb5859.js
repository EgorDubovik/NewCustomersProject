import{r as s,a as t,F as se,b as A,d as ae,a0 as re,i as oe,N as ne,j as a,P as ie,c as ce,B as de,y as le,z as q}from"./index-fe6e9605.js";import{a as me,T as U,S as he}from"./ServicesList-8178bb88.js";import{h as S}from"./moment-a9aaa855.js";import{I as ue}from"./IconEdit-6c8198c0.js";const fe=b=>{const[y,N]=s.useState(0),[u,c]=s.useState([]),{modal:k,setModal:d,techsIds:l,onAddRemovetechFromList:m,onSaveTeachs:g,onRemoveTech:w}=b,[x,n]=s.useState([]),v=()=>{A.get("company/techs").then(r=>{c(r.data.techs)}).catch(r=>{console.log(r)}).finally(()=>{})};return s.useEffect(()=>{v()},[]),s.useEffect(()=>{n(u.filter(r=>l.includes(r.id))),N(0)},[l,u]),t(se,{children:t(me,{techs:x,companyTechs:u,modal:k,setModal:d,techsIds:l,removeTech:r=>{N(r),w(r)},removeTechStatus:y,addRemovetechFromList:r=>{m(r)},saveNewTechs:()=>{g()}})})},Se=()=>{var B,z,O;const b=ae(),y=window.location.search,u=new URLSearchParams(y).get("startTime")||null,[c,k]=s.useState(re(u)),[d,l]=s.useState(new Date(new Date().getTime()+60*120*1e3)),[m,g]=s.useState("timeFrom"),[w,x]=s.useState(!1),[n,v]=s.useState([]),[E,C]=s.useState(!1),[p,r]=s.useState(!1),D=s.useRef(null),[R,P]=s.useState(!1),f=oe(e=>e.themeConfig.user);console.log("user:",f);const[L,F]=s.useState("loading"),[i,j]=s.useState(null),$=e=>{v(n.filter(o=>o.id!==e))},G=e=>{e.id=n.length+1,v([...n,e]),C(!1)},{customerId:I}=ne(),[M,J]=s.useState();s.useEffect(()=>{F("loading"),A.get(`customers/${I}`).then(e=>{J({id:e.data.customer.id,name:e.data.customer.name,phone:e.data.customer.phone,addresses:e.data.customer.address}),j(e.data.customer.address[0]||null),F("success")}).catch(e=>{F("error"),console.log(e)})},[]);const K=e=>{k(new Date(e)),w||l(new Date(e.getTime()+60*120*1e3))},Q=e=>{x(!0),l(new Date(e))},[V,H]=s.useState(!1),[h,T]=s.useState([]),W=e=>h.includes(e),X=e=>{T(h.filter(o=>o!==e))},Y=e=>{W(e)?T(h.filter(o=>o!==e)):T([...h,e])},Z=()=>{H(!1)};s.useEffect(()=>{T([f.id])},[f]);const _=e=>{j(e),r(!1)},ee=()=>{if(!R){if(!i){le("Please select an address");return}P(!0),A.post("appointment",{timeFrom:q(c),timeTo:q(d),services:n,techs:h,customerId:I,addressId:i==null?void 0:i.id}).then(e=>{e.status===200&&b("/appointment/"+e.data.appointment.id)}).catch(e=>{console.log(e),alert("Error, please try again")}).finally(()=>{P(!1)})}},te=()=>{r(e=>!e)};return s.useEffect(()=>{const e=o=>{D.current&&!D.current.contains(o.target)&&r(!1)};return p&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[p]),a("div",{children:[L==="loading"&&t(ie,{}),L==="error"&&t(ce,{}),L==="success"&&M&&a("div",{children:[t("div",{className:"flex items-center justify-center flex-wrap gap-4 my-4 md:my-0 md:justify-start",children:t("h2",{className:"text-xl",children:"Create appointment"})}),t("div",{className:"conteiner w-full md:w-1/3 m-auto",children:a("div",{className:"panel",children:[a("div",{className:"mb-5 relative",children:[t("div",{className:"border-b border-[#ebedf2] dark:border-[#1b2e4b] dark:bg-gray-800 px-2 rounded-t",children:a("div",{className:"flex items-center justify-between py-3",children:[a("h6",{className:"text-[#515365] font-bold dark:text-white-dark text-[15px]",children:[M.name,t("span",{className:"block text-white-dark dark:text-white-light font-normal text-xs mt-1",children:(i==null?void 0:i.full)||"No address in customer"})]}),t("div",{className:"h-full p-2 cursor-pointer rounded hover:dark:bg-white-dark/10 hover:bg-gray-100",onClick:()=>te(),children:t(ue,{})})]})}),t("div",{ref:D,className:"absolute "+(p?"":"hidden")+" left-0 right-0 top-17 bg-gray-100 dark:bg-gray-800 py-4 rounded-b z-50 shadow-lg",children:(B=M.addresses)==null?void 0:B.map((e,o)=>t("div",{className:"address-list p-4 hover:bg-gray-200  hover:dark:bg-gray-900 cursor-pointer",onClick:()=>_(e),children:e.full},o))})]}),a("div",{className:"mt-5",children:[a("div",{className:"mb-5 flex justify-center bg-gray-100 dark:bg-white-dark/10 rounded p-2",children:[a("div",{onClick:()=>g("timeFrom"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(m==="timeFrom"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[t("div",{children:"From:"}),a("div",{className:"ml-10 text-center",children:[t("div",{children:S(c).format("MMM DD")}),t("div",{children:S(c).format("hh:mm A")})]})]}),a("div",{onClick:()=>g("timeTo"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(m==="timeTo"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[t("div",{children:"To:"}),a("div",{className:"ml-10 text-center",children:[t("div",{children:S(d).format("MMM DD")}),t("div",{children:S(d).format("hh:mm A")})]})]})]}),a("div",{className:"text-[16px] dark:text-white text-right",children:[m==="timeFrom"&&t(U,{currentDate:c,options:{itemsHeight:45,textAlign:"right",borderColor:"#077afe",viewItems:((z=f.settings)==null?void 0:z.timePickerLineLength)||3},onDateChange:K}),m==="timeTo"&&t(U,{currentDate:d,options:{itemsHeight:45,daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe",itemsCount:((O=f.settings)==null?void 0:O.timePickerLineLength)||3},onDateChange:Q})]})]}),a("div",{className:"mt-5",children:[t("h2",{children:"Add services"}),t("div",{className:"mt-5",children:t(he,{services:n,onRemoveService:$,onSaveService:G,modal:E,setModal:C})})]}),a("div",{className:"mt-5",children:[t("h2",{children:"Add Technical"}),t("div",{className:"mt-5",children:t(fe,{techsIds:h,onRemoveTech:X,modal:V,setModal:H,onAddRemovetechFromList:Y,onSaveTeachs:Z})})]}),t("div",{className:"mt-8",children:t("button",{onClick:ee,className:"btn btn-primary w-full",children:R?a("div",{children:["Loading...",t(de,{})]}):"Create appointment"})})]})})]})]})};export{Se as default};
