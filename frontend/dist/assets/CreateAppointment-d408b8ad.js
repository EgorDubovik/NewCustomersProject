import{r as s,a as t,F as X,b as F,u as Y,g as Z,C as _,j as a,P as ee,c as te,B as se,q as H}from"./index-9d6fbf9e.js";import{a as ae,T as P,S as re}from"./ServicesList-339dae4f.js";import{h as y}from"./moment-a9aaa855.js";import{I as oe}from"./IconEdit-36f0bc60.js";import"./IconPlus-4965b79f.js";import"./IconCopy-a855ce04.js";const ne=N=>{const[k,n]=s.useState(0),[u,c]=s.useState([]),{modal:f,setModal:l,techsIds:m,onAddRemovetechFromList:x,onSaveTeachs:w,onRemoveTech:d}=N,[g,C]=s.useState([]),v=()=>{F.get("company/techs").then(r=>{c(r.data.techs)}).catch(r=>{console.log(r)}).finally(()=>{})};return s.useEffect(()=>{v()},[]),s.useEffect(()=>{C(u.filter(r=>m.includes(r.id))),n(0)},[m,u]),t(X,{children:t(ae,{techs:g,companyTechs:u,modal:f,setModal:l,techsIds:m,removeTech:r=>{n(r),d(r)},removeTechStatus:k,addRemovetechFromList:r=>{x(r)},saveNewTechs:()=>{w()}})})},ue=()=>{var I;const N=Y(),k=()=>{const e=new Date;return e.getMinutes()>45&&e.getMinutes()<=59&&(e.setHours(e.getHours()+1),e.setMinutes(0),e.setSeconds(0)),e},[n,u]=s.useState(k()),[c,f]=s.useState(new Date(new Date().getTime()+60*120*1e3)),[l,m]=s.useState("timeFrom"),[x,w]=s.useState(!1),[d,g]=s.useState([]),[C,v]=s.useState(!1);s.useState(!1);const[p,T]=s.useState(!1),b=s.useRef(null),[r,M]=s.useState(!1),L=Z(e=>e.themeConfig.user.id),[D,A]=s.useState("loading"),B=e=>{g(d.filter(o=>o.id!==e))},O=e=>{e.id=d.length+1,g([...d,e]),v(!1)},{customerId:E}=_(),[i,R]=s.useState({id:0,name:"Unknown",phone:"+1 123 456 7890",idAddress:0,addresses:[]});s.useEffect(()=>{A("loading"),F.get(`customers/${E}`).then(e=>{R({id:e.data.customer.id,name:e.data.customer.name,phone:e.data.customer.phone,addresses:e.data.customer.address,idAddress:0}),A("success")}).catch(e=>{A("error"),console.log(e)})},[]);const q=e=>{console.log("time from:",e),u(new Date(e)),x||f(new Date(e.getTime()+60*120*1e3))},z=e=>{w(!0),f(new Date(e))},[U,j]=s.useState(!1),[h,S]=s.useState([]),$=e=>h.includes(e),G=e=>{S(h.filter(o=>o!==e))},J=e=>{$(e)?S(h.filter(o=>o!==e)):S([...h,e])},K=()=>{j(!1)};s.useEffect(()=>{S([L])},[L]);const Q=e=>{R({...i,idAddress:e}),T(!1)},V=()=>{r||(M(!0),F.post("appointment",{timeFrom:H(n),timeTo:H(c),services:d,techs:h,customerId:E,addressId:i.addresses[i.idAddress].id||0}).then(e=>{e.status===200&&N("/appointment/"+e.data.appointment.id)}).catch(e=>{console.log(e),alert("Error, please try again")}).finally(()=>{M(!1)}))},W=()=>{T(e=>!e)};return s.useEffect(()=>{const e=o=>{b.current&&!b.current.contains(o.target)&&T(!1)};return p&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[p]),a("div",{children:[D==="loading"&&t(ee,{}),D==="error"&&t(te,{}),D==="success"&&a("div",{children:[t("div",{className:"flex items-center justify-center flex-wrap gap-4 my-4 md:my-0 md:justify-start",children:t("h2",{className:"text-xl",children:"Create appointment"})}),t("div",{className:"conteiner w-full md:w-1/3 m-auto",children:a("div",{className:"panel",children:[a("div",{className:"mb-5 relative",children:[t("div",{className:"border-b border-[#ebedf2] dark:border-[#1b2e4b] dark:bg-gray-800 px-2 rounded-t",children:a("div",{className:"flex items-center justify-between py-3",children:[a("h6",{className:"text-[#515365] font-bold dark:text-white-dark text-[15px]",children:[i.name,t("span",{className:"block text-white-dark dark:text-white-light font-normal text-xs mt-1",children:(I=i.addresses[i.idAddress])==null?void 0:I.full})]}),t("div",{className:"h-full p-2 cursor-pointer rounded hover:dark:bg-white-dark/10 hover:bg-gray-100",onClick:()=>W(),children:t(oe,{})})]})}),t("div",{ref:b,className:"absolute "+(p?"":"hidden")+" left-0 right-0 top-17 bg-gray-100 dark:bg-gray-800 py-4 rounded-b z-50 shadow-lg",children:i.addresses.map((e,o)=>t("div",{className:"address-list p-4 hover:bg-gray-200  hover:dark:bg-gray-900 cursor-pointer",onClick:()=>Q(o),children:e.full},o))})]}),a("div",{className:"mt-5",children:[a("div",{className:"mb-5 flex justify-center bg-gray-100 dark:bg-white-dark/10 rounded p-2",children:[a("div",{onClick:()=>m("timeFrom"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(l==="timeFrom"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[t("div",{children:"From:"}),a("div",{className:"ml-10 text-center",children:[t("div",{children:y(n).format("MMM DD")}),t("div",{children:y(n).format("hh:mm A")})]})]}),a("div",{onClick:()=>m("timeTo"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(l==="timeTo"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[t("div",{children:"To:"}),a("div",{className:"ml-10 text-center",children:[t("div",{children:y(c).format("MMM DD")}),t("div",{children:y(c).format("hh:mm A")})]})]})]}),a("div",{className:"text-[16px] dark:text-white text-right",children:[l==="timeFrom"&&t(P,{currentDate:n,options:{itemsHeight:45,textAlign:"right",borderColor:"#077afe"},onDateChange:q}),l==="timeTo"&&t(P,{currentDate:c,options:{itemsHeight:45,daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe"},onDateChange:z})]})]}),a("div",{className:"mt-5",children:[t("h2",{children:"Add services"}),t("div",{className:"mt-5",children:t(re,{services:d,onRemoveService:B,onSaveService:O,modal:C,setModal:v})})]}),a("div",{className:"mt-5",children:[t("h2",{children:"Add Technical"}),t("div",{className:"mt-5",children:t(ne,{techsIds:h,onRemoveTech:G,modal:U,setModal:j,onAddRemovetechFromList:J,onSaveTeachs:K})})]}),t("div",{className:"mt-8",children:t("button",{onClick:V,className:"btn btn-primary w-full",children:r?a("div",{children:["Loading...",t(se,{})]}):"Create appointment"})})]})})]})]})};export{ue as default};
