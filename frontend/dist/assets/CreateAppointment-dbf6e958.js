import{r as s,a as t,F as te,b as A,d as se,i as ae,M as re,j as a,P as oe,c as ne,B as ce,y as ie,z as O}from"./index-f972b302.js";import{a as de,T as q,S as le}from"./ServicesList-b62cae1b.js";import{h as v}from"./moment-a9aaa855.js";import{I as me}from"./IconEdit-80ff95bf.js";const he=p=>{const[T,S]=s.useState(0),[c,b]=s.useState([]),{modal:l,setModal:y,techsIds:n,onAddRemovetechFromList:u,onSaveTeachs:m,onRemoveTech:f}=p,[w,N]=s.useState([]),i=()=>{A.get("company/techs").then(r=>{b(r.data.techs)}).catch(r=>{console.log(r)}).finally(()=>{})};return s.useEffect(()=>{i()},[]),s.useEffect(()=>{N(c.filter(r=>n.includes(r.id))),S(0)},[n,c]),t(te,{children:t(de,{techs:w,companyTechs:c,modal:l,setModal:y,techsIds:n,removeTech:r=>{S(r),f(r)},removeTechStatus:T,addRemovetechFromList:r=>{u(r)},saveNewTechs:()=>{m()}})})},pe=()=>{var z;const p=se(),T=window.location.search,c=new URLSearchParams(T).get("startTime")||null;console.log(c);const b=()=>{if(c)return new Date(c);const e=new Date;return e.getMinutes()>45&&e.getMinutes()<=59&&(e.setHours(e.getHours()+1),e.setMinutes(0),e.setSeconds(0)),e},[l,y]=s.useState(b()),[n,u]=s.useState(new Date(new Date().getTime()+60*120*1e3)),[m,f]=s.useState("timeFrom"),[w,N]=s.useState(!1),[i,x]=s.useState([]),[E,k]=s.useState(!1),[r,C]=s.useState(!1),D=s.useRef(null),[R,j]=s.useState(!1),I=ae(e=>e.themeConfig.user.id),[M,F]=s.useState("loading"),[d,P]=s.useState(null),U=e=>{x(i.filter(o=>o.id!==e))},$=e=>{e.id=i.length+1,x([...i,e]),k(!1)},{customerId:H}=re(),[L,G]=s.useState();s.useEffect(()=>{F("loading"),A.get(`customers/${H}`).then(e=>{G({id:e.data.customer.id,name:e.data.customer.name,phone:e.data.customer.phone,addresses:e.data.customer.address}),P(e.data.customer.address[0]||null),F("success")}).catch(e=>{F("error"),console.log(e)})},[]);const J=e=>{y(new Date(e)),w||u(new Date(e.getTime()+60*120*1e3))},K=e=>{N(!0),u(new Date(e))},[Q,B]=s.useState(!1),[h,g]=s.useState([]),V=e=>h.includes(e),W=e=>{g(h.filter(o=>o!==e))},X=e=>{V(e)?g(h.filter(o=>o!==e)):g([...h,e])},Y=()=>{B(!1)};s.useEffect(()=>{g([I])},[I]);const Z=e=>{P(e),C(!1)},_=()=>{if(!R){if(!d){ie("Please select an address");return}j(!0),A.post("appointment",{timeFrom:O(l),timeTo:O(n),services:i,techs:h,customerId:H,addressId:d==null?void 0:d.id}).then(e=>{e.status===200&&p("/appointment/"+e.data.appointment.id)}).catch(e=>{console.log(e),alert("Error, please try again")}).finally(()=>{j(!1)})}},ee=()=>{C(e=>!e)};return s.useEffect(()=>{const e=o=>{D.current&&!D.current.contains(o.target)&&C(!1)};return r&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[r]),a("div",{children:[M==="loading"&&t(oe,{}),M==="error"&&t(ne,{}),M==="success"&&L&&a("div",{children:[t("div",{className:"flex items-center justify-center flex-wrap gap-4 my-4 md:my-0 md:justify-start",children:t("h2",{className:"text-xl",children:"Create appointment"})}),t("div",{className:"conteiner w-full md:w-1/3 m-auto",children:a("div",{className:"panel",children:[a("div",{className:"mb-5 relative",children:[t("div",{className:"border-b border-[#ebedf2] dark:border-[#1b2e4b] dark:bg-gray-800 px-2 rounded-t",children:a("div",{className:"flex items-center justify-between py-3",children:[a("h6",{className:"text-[#515365] font-bold dark:text-white-dark text-[15px]",children:[L.name,t("span",{className:"block text-white-dark dark:text-white-light font-normal text-xs mt-1",children:(d==null?void 0:d.full)||"No address in customer"})]}),t("div",{className:"h-full p-2 cursor-pointer rounded hover:dark:bg-white-dark/10 hover:bg-gray-100",onClick:()=>ee(),children:t(me,{})})]})}),t("div",{ref:D,className:"absolute "+(r?"":"hidden")+" left-0 right-0 top-17 bg-gray-100 dark:bg-gray-800 py-4 rounded-b z-50 shadow-lg",children:(z=L.addresses)==null?void 0:z.map((e,o)=>t("div",{className:"address-list p-4 hover:bg-gray-200  hover:dark:bg-gray-900 cursor-pointer",onClick:()=>Z(e),children:e.full},o))})]}),a("div",{className:"mt-5",children:[a("div",{className:"mb-5 flex justify-center bg-gray-100 dark:bg-white-dark/10 rounded p-2",children:[a("div",{onClick:()=>f("timeFrom"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(m==="timeFrom"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[t("div",{children:"From:"}),a("div",{className:"ml-10 text-center",children:[t("div",{children:v(l).format("MMM DD")}),t("div",{children:v(l).format("hh:mm A")})]})]}),a("div",{onClick:()=>f("timeTo"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(m==="timeTo"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[t("div",{children:"To:"}),a("div",{className:"ml-10 text-center",children:[t("div",{children:v(n).format("MMM DD")}),t("div",{children:v(n).format("hh:mm A")})]})]})]}),a("div",{className:"text-[16px] dark:text-white text-right",children:[m==="timeFrom"&&t(q,{currentDate:l,options:{itemsHeight:45,textAlign:"right",borderColor:"#077afe"},onDateChange:J}),m==="timeTo"&&t(q,{currentDate:n,options:{itemsHeight:45,daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe"},onDateChange:K})]})]}),a("div",{className:"mt-5",children:[t("h2",{children:"Add services"}),t("div",{className:"mt-5",children:t(le,{services:i,onRemoveService:U,onSaveService:$,modal:E,setModal:k})})]}),a("div",{className:"mt-5",children:[t("h2",{children:"Add Technical"}),t("div",{className:"mt-5",children:t(he,{techsIds:h,onRemoveTech:W,modal:Q,setModal:B,onAddRemovetechFromList:X,onSaveTeachs:Y})})]}),t("div",{className:"mt-8",children:t("button",{onClick:_,className:"btn btn-primary w-full",children:R?a("div",{children:["Loading...",t(ce,{})]}):"Create appointment"})})]})})]})]})};export{pe as default};
