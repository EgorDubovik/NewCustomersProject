import{r as l,f as z,b as e,g as ue,h as Q,i as fe,a as D,F as E,j as s,u as V,B,t as L,_ as $,k as _,v as H,m as Y,l as te,L as W,n as ge,I as pe,o as ve,p as ye,q as be,P as xe,S as ae,w as we,x as Ne,y as Ce,z as ke,d as Se,s as Te}from"./index-7933883d.js";import{h as P}from"./moment-a9aaa855.js";import{T as U,a as De,S as Fe}from"./ServicesList-bd1b082c.js";import{A as Me}from"./AppointmentsScheduler-074d546b.js";import{I as je}from"./IconPhone-5e9eb364.js";import{I as Le}from"./IconCopy-03e0896f.js";import{I as Ae}from"./IconPlus-2a788e53.js";import{I as Pe}from"./IconTrash-31bc76cc.js";const se=l.createContext(null),I=()=>{const t=l.useContext(se);if(!t)throw new Error("useAppointmentContext must be used within an AppointmentProvider");return t},Ie=({children:t,appointmentData:h})=>{const[a,n]=l.useState(h),[i,f]=l.useState("loading"),g=z(c=>c.themeConfig.companyInfo.taxRate),k={appointment:a,setAppointment:n,updateStatus:c=>{a&&n({...a,status:c})},updateNotes:c=>{a&&n({...a,notes:c})},updatePayments:c=>{if(a){const p={...a.job,payments:c,total_paid:ue(c),remaining_balance:Q(c,a.job.total_amount)};n({...a,job:p})}},updateServices:c=>{if(a){const{tax:p,total:o}=fe(c,g),S={...a.job,services:c,total_amount:o,total_tax:p,remaining_balance:Q(a.job.payments,o)};n({...a,job:S})}},updateTime:(c,p)=>{a&&n({...a,start:c,end:p})},updateImages:c=>{a&&n({...a,images:c})},updateTechs:c=>{a&&n({...a,techs:c})},fetchAppointmentData:c=>{f("loading"),console.log("fetching appointment"),D.get(`/appointment/${c}`).then(p=>{console.log(p.data);let o=p.data.appointment;o.start=P(o.start),o.end=P(o.end),n(o),f("success")}).catch(p=>{console.log(p),f("error")})},loadingStatus:i};return e(se.Provider,{value:k,children:t})},$e=({className:t,fill:h=!1,duotone:a=!0})=>e(E,{children:h?s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{opacity:a?"0.5":"1",d:"M3.46447 20.5355C4.92893 22 7.28595 22 12 22C16.714 22 19.0711 22 20.5355 20.5355C22 19.0711 22 16.714 22 12C22 7.28595 22 4.92893 20.5355 3.46447C19.0711 2 16.714 2 12 2C7.28595 2 4.92893 2 3.46447 3.46447C2 4.92893 2 7.28595 2 12C2 16.714 2 19.0711 3.46447 20.5355Z",fill:"currentColor"}),e("path",{d:"M18.581 9.47431C18.843 9.15344 18.7952 8.68098 18.4743 8.41903C18.1534 8.15709 17.681 8.20486 17.419 8.52573L12.2514 14.8559C12.0385 14.7803 11.7939 14.8014 11.5901 14.9345C11.2432 15.1609 11.1456 15.6256 11.372 15.9724L11.6575 16.4099C11.7883 16.6103 12.0068 16.7362 12.2457 16.749C12.4846 16.7617 12.7153 16.6597 12.8666 16.4743L18.581 9.47431Z",fill:a?"currentColor":"white"}),e("path",{d:"M14.581 9.47431C14.843 9.15343 14.7952 8.68097 14.4743 8.41903C14.1534 8.15709 13.681 8.20487 13.419 8.52574L8.28574 14.814L6.58102 12.7257C6.31908 12.4049 5.84662 12.3571 5.52574 12.619C5.20487 12.881 5.15709 13.3534 5.41903 13.6743L7.70474 16.4743C7.84718 16.6488 8.0605 16.75 8.28574 16.75C8.51098 16.75 8.7243 16.6488 8.86673 16.4743L14.581 9.47431Z",fill:a?"currentColor":"white"})]}):s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("path",{opacity:a?"0.5":"1",d:"M4 12.9L7.14286 16.5L15 7.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M20.0002 7.5625L11.4286 16.5625L11.0002 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),_e=({className:t,fill:h=!1,duotone:a=!0})=>e(E,{children:h?a?s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("path",{opacity:a?"0.5":"1",d:"M9.99976 20H13.9998C17.771 20 19.6566 20 20.8282 18.8284C21.9998 17.6569 21.9998 15.7712 21.9998 12C21.9998 11.5581 21.9981 10.392 21.9962 10H2C1.99811 10.392 1.99976 11.5581 1.99976 12C1.99976 15.7712 1.99976 17.6569 3.17133 18.8284C4.34291 20 6.22852 20 9.99976 20Z",fill:"currentColor"}),e("path",{d:"M9.99484 4H14.0052C17.7861 4 19.6766 4 20.8512 5.11578C21.6969 5.91916 21.9337 7.07507 22 9V10H2V9C2.0663 7.07507 2.3031 5.91916 3.14881 5.11578C4.3234 4 6.21388 4 9.99484 4Z",fill:"currentColor"}),e("path",{d:"M12.5 15.25C12.0858 15.25 11.75 15.5858 11.75 16C11.75 16.4142 12.0858 16.75 12.5 16.75H14C14.4142 16.75 14.75 16.4142 14.75 16C14.75 15.5858 14.4142 15.25 14 15.25H12.5Z",fill:"currentColor"}),e("path",{d:"M6 15.25C5.58579 15.25 5.25 15.5858 5.25 16C5.25 16.4142 5.58579 16.75 6 16.75H10C10.4142 16.75 10.75 16.4142 10.75 16C10.75 15.5858 10.4142 15.25 10 15.25H6Z",fill:"currentColor"})]}):s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("path",{d:"M14 4H10C6.22876 4 4.34315 4 3.17157 5.17157C2.32803 6.01511 2.09185 7.22882 2.02572 9.25H21.9743C21.9082 7.22882 21.672 6.01511 20.8284 5.17157C19.6569 4 17.7712 4 14 4Z",fill:"currentColor"}),e("path",{d:"M10 20H14C17.7712 20 19.6569 20 20.8284 18.8284C22 17.6569 22 15.7712 22 12C22 11.5581 22 11.142 21.9981 10.75H2.00189C2 11.142 2 11.5581 2 12C2 15.7712 2 17.6569 3.17157 18.8284C4.34315 20 6.22876 20 10 20Z",fill:"currentColor"}),e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.25 16C5.25 15.5858 5.58579 15.25 6 15.25H10C10.4142 15.25 10.75 15.5858 10.75 16C10.75 16.4142 10.4142 16.75 10 16.75H6C5.58579 16.75 5.25 16.4142 5.25 16Z",fill:"white"}),e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.75 16C11.75 15.5858 12.0858 15.25 12.5 15.25H14C14.4142 15.25 14.75 15.5858 14.75 16C14.75 16.4142 14.4142 16.75 14 16.75H12.5C12.0858 16.75 11.75 16.4142 11.75 16Z",fill:"white"})]}):s("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("path",{d:"M2 12C2 8.22876 2 6.34315 3.17157 5.17157C4.34315 4 6.22876 4 10 4H14C17.7712 4 19.6569 4 20.8284 5.17157C22 6.34315 22 8.22876 22 12C22 15.7712 22 17.6569 20.8284 18.8284C19.6569 20 17.7712 20 14 20H10C6.22876 20 4.34315 20 3.17157 18.8284C2 17.6569 2 15.7712 2 12Z",stroke:"currentColor",strokeWidth:"1.5"}),e("path",{opacity:a?"0.5":"1",d:"M10 16H6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:a?"0.5":"1",d:"M14 16H12.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:a?"0.5":"1",d:"M2 10L22 10",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}),He=({className:t,fill:h=!1,duotone:a=!0})=>s("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("path",{d:"M9.5 7L4.5 12L9.5 17",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{opacity:a?"0.5":"1",d:"M4.5 12L14.5 12C16.1667 12 19.5 13 19.5 17",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),Ee=({className:t,fill:h=!1,duotone:a=!0})=>e(E,{children:h?s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("path",{opacity:a?"0.5":"1",d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 7.25C12.4142 7.25 12.75 7.58579 12.75 8V11.6893L15.0303 13.9697C15.3232 14.2626 15.3232 14.7374 15.0303 15.0303C14.7374 15.3232 14.2626 15.3232 13.9697 15.0303L11.4697 12.5303C11.329 12.3897 11.25 12.1989 11.25 12V8C11.25 7.58579 11.5858 7.25 12 7.25Z",fill:a?"currentColor":"white"})]}):s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e("circle",{opacity:a?"0.5":"1",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"1.5"}),e("path",{d:"M12 8V12L14.5 14.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),Re=()=>{var q,J;const{appointment:t,updateStatus:h,updatePayments:a}=I(),n=((q=t==null?void 0:t.job)==null?void 0:q.total_amount)||0,i=((J=t==null?void 0:t.job)==null?void 0:J.remaining_balance)||0,[f,g]=l.useState(!1),[y,d]=l.useState(!1),[b,w]=l.useState(!1),u=["Credit","Transfer","Check","Cash"],[m,C]=l.useState(0),[r,k]=l.useState("full"),[c,p]=l.useState(i),o=V(),[S,v]=l.useState(!1),[x,j]=l.useState("timeFrom"),[M,T]=l.useState(new Date),[F,R]=l.useState(new Date),[Z,le]=l.useState(!1),[O,ne]=l.useState(!0),[G,re]=l.useState(!0);l.useEffect(()=>{p(i)},[i]);const oe=N=>{T(new Date(N)),Z||R(new Date(N.getTime()+60*120*1e3))},ie=N=>{le(!0),R(new Date(N))},ce=N=>{if(isNaN(N.target.value))return;const A=N.target.value;p(A)},K=N=>{N==="full"?(p(i),k("full")):N==="deposit"&&(p(100),k("deposit"))},de=()=>{w(!0),c>0?D.post(`appointment/payment/${t==null?void 0:t.job_id}`,{amount:c,payment_type:u[m],send_invoice:G}).then(N=>{a([...(t==null?void 0:t.job.payments)||[],N.data.payment]),d(!1)}).catch(N=>{console.log(N)}).finally(()=>{w(!1)}):(console.error("Enter valid amount"),p(0))},me=()=>{g(!0),D.put(`appointment/${t==null?void 0:t.id}/status`).then(N=>{h((t==null?void 0:t.status)===0?1:0)}).catch(N=>{console.log(N)}).finally(()=>{g(!1)})},he=()=>{const N={timeFrom:Y(M),timeTo:Y(F),isFinishCurerentAppointment:O,appointmentId:t==null?void 0:t.id};D.post(`appointment/copy/${t==null?void 0:t.id}`,N).then(A=>{o(`/appointment/${A.data.appointment.id}`),v(!1)}).catch(A=>{console.log(A),alert("Error, try again")}).finally(()=>{v(!1)})};return s("div",{className:"flex gap-2 md:justify-end justify-around mb-2",children:[e("div",{className:"flex-auto md:flex-none",children:s("button",{onClick:me,type:"button",className:`btn ${(t==null?void 0:t.status)===0?"btn-primary":"btn-outline-dark"} h-full text-[13px] px-0 md:px-4 w-full whitespace-nowrap overflow-hidden text-ellipsis`,children:[f?e(B,{}):(t==null?void 0:t.status)===0?e($e,{}):e(He,{}),e("span",{className:"ml-1",children:(t==null?void 0:t.status)===0?"Finish Appointment":"Back to Active"})]})}),e("div",{className:"flex-auto md:flex-none ",children:s("button",{type:"button",onClick:()=>{v(!0)},className:"btn btn-primary h-full text-[13px] px-0 md:px-4 w-full whitespace-nowrap overflow-hidden text-ellipsis",children:[e(Ee,{className:"mr-1"}),"Create copy"]})}),e("div",{className:"flex-auto md:flex-none",children:s("button",{type:"button",className:"btn btn-primary h-full text-[13px] px-0 md:px-4 w-full whitespace-nowrap overflow-hidden text-ellipsis",onClick:()=>d(!0),children:[e(_e,{className:"mr-1"}),"Pay"]})}),e(L,{appear:!0,show:S,as:l.Fragment,children:s($,{as:"div",open:S,onClose:()=>v(!1),children:[e(L.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{id:"login_modal",className:"fixed inset-0 bg-[black]/60 z-[999] overflow-y-auto",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(L.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e($.Panel,{className:"panel border-0 py-1 rounded-lg overflow-hidden w-full max-w-lg my-8 text-black dark:text-white-dark",children:e("div",{className:"py-4 px-2",children:s("div",{className:"mt-5",children:[s("div",{className:"mb-5 flex justify-center bg-gray-100 dark:bg-white-dark/10 rounded p-2",children:[s("div",{onClick:()=>j("timeFrom"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(x==="timeFrom"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[e("div",{children:"From:"}),s("div",{className:"ml-10 text-center",children:[e("div",{children:_(M,"MMM DD")}),e("div",{children:_(M,"hh:mm A")})]})]}),s("div",{onClick:()=>j("timeTo"),className:"w-1/2 timeFrom flex justify-center items-center cursor-pointer py-3 rounded "+(x==="timeTo"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[e("div",{children:"To:"}),s("div",{className:"ml-10 text-center",children:[e("div",{children:_(F,"MMM DD")}),e("div",{children:_(F,"hh:mm A")})]})]})]}),s("div",{className:"text-[16px] dark:text-white text-right",children:[x==="timeFrom"&&e(U,{currentDate:M,options:{itemsHeight:45,textAlign:"right",borderColor:"#077afe"},onDateChange:oe}),x==="timeTo"&&e(U,{currentDate:F,options:{itemsHeight:45,textAlign:"right",daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe"},onDateChange:ie})]}),e("div",{className:"flex mt-4",children:s("label",{className:"flex items-center cursor-pointer",children:[e("input",{type:"checkbox",className:"form-checkbox",checked:O,onChange:()=>ne(N=>!N)}),e("span",{className:" text-white-dark",children:"Finish current appointment"})]})}),e("div",{className:"mt-4",children:e("button",{type:"button",onClick:he,className:"btn btn-primary w-full",children:"Create new appointment"})})]})})})})})})]})}),e(L,{appear:!0,show:y,as:l.Fragment,children:s($,{as:"div",open:y,onClose:()=>d(!1),children:[e(L.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{id:"login_modal",className:"fixed inset-0 bg-[black]/60 z-[999] overflow-y-auto",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(L.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e($.Panel,{className:"panel border-0 py-1 rounded-lg overflow-hidden w-full max-w-lg my-8 text-black dark:text-white-dark",children:s("div",{className:"py-4 px-2",children:[s("div",{className:"title flex justify-between",children:[s("span",{className:"text-danger",children:["Remaining: ",H(i)]}),s("span",{className:"text-success",children:["Total: ",H(n)]})]}),s("div",{className:"input-amount text-center text-5xl py-10",children:["$"," ",e("input",{type:"text",pattern:"\\d*\\.?\\d*",className:"w-[200px] bg-transparent border-b border-gray-700 text-center outline-none",value:c,onChange:ce})]}),s("div",{className:"flex justify-center",children:[i>100&&e("button",{type:"button",onClick:()=>K("deposit"),className:`btn ${r==="deposit"?"btn-primary":"btn-outline-primary"} mr-4`,children:"Deposit"}),e("button",{type:"button",onClick:()=>K("full"),className:`btn ${r==="full"?"btn-primary":"btn-outline-primary"}`,children:"Full"})]}),e("div",{className:"payment-methods mt-10",children:e("div",{className:"relative inline-flex w-full align-middle justify-around",children:u.map((N,A)=>e("button",{onClick:()=>C(A),type:"button",className:`btn ${m===A?"btn-primary":"btn-outline-primary"} w-full ${A===0?"rounded-r-none":A===u.length-1?"rounded-l-none":"rounded-none"} `,children:N},A))})}),e("div",{className:"flex mt-10",children:s("label",{className:"flex items-center cursor-pointer",children:[e("input",{type:"checkbox",className:"form-checkbox",checked:G,onChange:()=>re(N=>!N)}),e("span",{className:" text-white-dark",children:"Send invoice automatically"})]})}),s("div",{className:"flex justify-end items-center mt-4",children:[e("button",{type:"button",onClick:()=>d(!1),className:"btn btn-outline-danger",children:"Discard"}),s("button",{type:"button",onClick:de,className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:["Pay Now",b&&e(B,{})]})]})]})})})})})]})})]})},Be=()=>{const{appointment:t,updateTime:h}=I(),a=z(x=>x.themeConfig.theme),[n,i]=l.useState([]),[f,g]=l.useState(!1),[y,d]=l.useState("timeFrom"),[b,w]=l.useState(new Date((t==null?void 0:t.start)||new Date)),[u,m]=l.useState(new Date((t==null?void 0:t.end)||new Date(b.getTime()+60*120*1e3))),[C,r]=l.useState(!1),[k,c]=l.useState(!1),p=x=>{w(x),C||m(new Date(x.getTime()+60*120*1e3))},o=x=>{r(!0),m(x)},S=()=>{c(!0),D.put(`/appointment/${t==null?void 0:t.id}`,{timeFrom:Y(b),timeTo:Y(u)}).then(x=>{h(b.toString(),u.toString()),g(!1)}).catch(x=>{alert("Something went wrong"),console.log(x)}).finally(()=>{c(!1)})},v=x=>{const j=T=>{var Z;let F=a==="dark"?"#ffffff29":"#ccc";F=T.status==0?((Z=T==null?void 0:T.techs)==null?void 0:Z.length)>0?T==null?void 0:T.techs[0].color:"#1565C0":F;let R=T.status===0?"text-white":a==="dark"?"text-gray-300":"text-gray-500";return{bgColor:F,textColor:R}},M=x.map(T=>{const{bgColor:F,textColor:R}=j(T);return{id:T.id,title:T.title??"Unknown",start:T.start,end:T.end,status:T.status,bg:F,addClass:R}});i(M)};return l.useEffect(()=>{v([t])},[a,t]),s(E,{children:[s("div",{className:"flex items-center justify-between pb-4",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Appointment time"}),e("button",{className:"btn btn-primary p-2 rounded-full",onClick:()=>g(!0),children:e(te,{className:"w-4 h-4"})})]}),e("div",{className:"",children:e("div",{className:"dark:bg-white-dark/5 bg-gray-200 rounded",children:e("div",{className:"p-4",children:s("div",{className:"flex justify-between items-center",children:[e("h4",{className:"font-semibold dark:text-white-light",children:P(t==null?void 0:t.start).format("ddd, MMM DD")}),s("p",{className:"font-semibold dark:text-white-light",children:[P(t==null?void 0:t.start).format("hh:mm A")," - ",P(t==null?void 0:t.end).format("hh:mm A")]})]})})})}),e("div",{className:"hidden md:block",children:e(Me,{appointments:n,currentDate:t==null?void 0:t.start,isHeader:!1,isDaysNames:!1,viewType:"day",startTime:"07:00",endTime:"21:00",blockHeight:40,scheduleBgClass:"bg-none"})}),e(L,{appear:!0,show:f,as:l.Fragment,children:s($,{as:"div",open:f,onClose:()=>g(!1),children:[e(L.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{id:"login_modal",className:"fixed inset-0 bg-[black]/60 z-[999] overflow-y-auto",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(L.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e($.Panel,{className:"panel border-0 py-6 px-4 rounded-lg overflow-hidden w-full max-w-lg mt-10  text-black dark:text-white-dark",children:s("div",{className:"p-2 md:p-4",children:[s("div",{className:"mt-1",children:[s("div",{className:"mb-5 flex justify-center bg-gray-100 dark:bg-white-dark/10 rounded p-2",children:[s("div",{onClick:()=>d("timeFrom"),className:"w-1/2 timeFrom flex justify-between items-center cursor-pointer py-3 px-2 rounded "+(y==="timeFrom"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[e("div",{children:"From:"}),s("div",{className:"text-center",children:[e("div",{children:P(b).format("MMM DD")}),e("div",{children:P(b).format("hh:mm A")})]})]}),s("div",{onClick:()=>d("timeTo"),className:"w-1/2 timeFrom flex justify-between items-center cursor-pointer py-3 px-2 rounded "+(y==="timeTo"?"dark:bg-black/25 dark:text-white font-bold bg-gray-200":""),children:[e("div",{children:"To:"}),s("div",{className:"text-center",children:[e("div",{children:P(u).format("MMM DD")}),e("div",{children:P(u).format("hh:mm A")})]})]})]}),s("div",{className:"text-[16px] dark:text-white-light",children:[y==="timeFrom"&&e(U,{currentDate:b,options:{itemsHeight:45,daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe"},onDateChange:p}),y==="timeTo"&&e(U,{currentDate:u,options:{itemsHeight:45,daysNameFormat:"MMM DD, DDDD",borderColor:"#077afe"},onDateChange:o})]})]}),e("div",{className:"flex justify-center mt-4",children:s("button",{onClick:S,className:"btn btn-primary w-full",children:["Update",k&&e(B,{})]})})]})})})})})]})})]})},Ze=t=>{var i,f,g,y,d,b,w,u;const h=V(),{appointment:a}=I(),n=m=>{navigator.clipboard.writeText(m).then(()=>{ye("Phone number copied to clipboard")}).catch(C=>{be("Failed to copy phone number")})};return s("div",{className:"panel p-0 pb-4",children:[s("div",{className:"flex items-center justify-between p-4",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Customer"}),e(W,{to:"/customer/update/"+(((i=a==null?void 0:a.customer)==null?void 0:i.id)??0)+"?redirectTo="+window.location.pathname,className:"ltr:ml-auto rtl:mr-auto btn btn-primary p-2 rounded-full",children:e(te,{className:"w-4 h-4"})})]}),s("div",{className:"mb-1",children:[s("div",{className:"flex flex-col justify-center items-center ",children:[e("div",{className:"w-full h-[200px] rounded text-center dark:bg-gray-800 bg-gray-200",children:"MAP"}),e("p",{className:"font-semibold text-primary text-lg mt-4",children:e(W,{to:"/customer/"+((f=a==null?void 0:a.customer)==null?void 0:f.id),className:"hover:underline",children:(g=a==null?void 0:a.customer)==null?void 0:g.name})})]}),e("div",{className:"px-4 pb-4",children:s("ul",{className:"mt-5 flex flex-col m-auto space-y-4 font-semibold text-white-dark",children:[s("li",{className:"flex items-center gap-2",children:[e(ge,{className:"shrink-0"}),e("a",{href:`https://www.google.com/maps?q=${encodeURIComponent(a==null?void 0:a.address)}`,target:"_blank",rel:"noopener noreferrer",children:a==null?void 0:a.address})]}),s("li",{className:"flex justify-between",children:[s("div",{className:"flex gap-2",children:[e(je,{}),e("span",{className:"whitespace-nowrap",dir:"ltr",children:e("a",{href:`tel:${a==null?void 0:a.customer.phone}`,children:(y=a==null?void 0:a.customer)==null?void 0:y.phone})})]}),e("button",{onClick:()=>n((a==null?void 0:a.customer.phone)||""),children:e(Le,{className:"text-primary cursor-pointer"})})]}),e("li",{children:s("button",{className:"flex justify-between w-full",onClick:()=>h("/invoice/send/"+(a==null?void 0:a.id)),children:[s("div",{className:"flex gap-2",children:[e(pe,{className:"w-5 h-5 shrink-0"}),e("span",{className:"text-primary truncate",children:(d=a==null?void 0:a.customer)==null?void 0:d.email})]}),((b=a==null?void 0:a.customer)==null?void 0:b.email)&&s("div",{className:"flex gap-2 text-primary",children:[e(ve,{className:"w-5 h-5 shrink-0"}),"Send Invoice"]})]})}),s("div",{className:"mt-2",children:[s("div",{className:"text-right",children:["Invoices (",((w=a==null?void 0:a.job)==null?void 0:w.invoices.length)||0,")"]}),e("div",{className:"flex justify-end mt-2",children:(u=a==null?void 0:a.job)==null?void 0:u.invoices.map(m=>s(W,{to:"/invoice/"+m.id,className:"text-primary underline",children:["Invoice #",m.id," at ",_(m.created_at,"MMM DD YYYY")]},m.id))})]})]})})]})]})},X=()=>{const{appointment:t,updateTechs:h}=I(),a=(t==null?void 0:t.techs)||[],n=t==null?void 0:t.id,[i,f]=l.useState([]),[g,y]=l.useState([]),[d,b]=l.useState(!1),[w,u]=l.useState(0),[m,C]=l.useState(!1),r=v=>i.includes(v),k=()=>{D.get("company/techs").then(v=>{y(v.data.techs)}).catch(v=>{console.log(v)})},c=()=>{C(!0),D.post(`appointment/tech/${n}`,{techs:i}).then(v=>{console.log(v),v.status===200&&h(g.filter(x=>i.includes(x.id))),b(!1)}).catch(v=>{alert("Something went wrong. Please try again later"),console.log(v)}).finally(()=>{C(!1)})},p=()=>{f(a.map(v=>v.id))},o=v=>{r(v)?f(i.filter(x=>x!==v)):f([...i,v])};return l.useEffect(()=>{k()},[]),l.useEffect(()=>{p()},[a]),s("div",{className:"",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Technical"}),e(De,{techs:a,modal:d,setModal:b,techsIds:i,companyTechs:g,removeTech:v=>{u(v),D.delete(`appointment/tech/${n}/${v}`).then(x=>{x.status===200&&h(a.filter(j=>j.id!==v))}).catch(x=>{alert("Something went wrong. Please try again later"),console.log(x)}).finally(()=>{u(0)})},removeTechStatus:w,saveNewTechs:c,saveNewTechStatus:m,addRemovetechFromList:o})]})},ee=t=>{var x;const{appointment:h,updateImages:a}=I(),n=h==null?void 0:h.id,[i,f]=l.useState((h==null?void 0:h.images)||[]),[g,y]=l.useState(!1),d=l.useRef(null),[b,w]=l.useState([]),[u,m]=l.useState(!1),[C,r]=l.useState(0);l.useEffect(()=>{p()},[b]);const k=j=>{w([...j.target.files])},c=()=>{d.current&&!g&&d.current.click()},p=async()=>{y(!0);const j=b.map(async M=>{const T=new FormData;T.append("image",M);try{const F=await D.post("appointment/images/"+n,T,{headers:{"Content-Type":"multipart/form-data"}});return console.log("File uploaded successfully:",F.data),f([...i,F.data]),F.data}catch(F){throw console.error("Error uploading file:",F),F}});try{const M=await Promise.all(j);console.log("All files uploaded successfully:",M)}catch(M){console.error("Error uploading one or more files:",M)}finally{y(!1)}},o=j=>{console.log("open gallery"),r(j),m(!0)},S=()=>{C<i.length-1?r(C+1):r(0)},v=()=>{C>0?r(C-1):r(i.length-1)};return s(E,{children:[s("div",{className:"flex items-center justify-between px-4 py-2",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Images"}),e("button",{onClick:c,className:"ltr:ml-auto rtl:mr-auto btn btn-primary p-2 rounded-full",children:e(Ae,{className:"w-4 h-4"})}),e("input",{type:"file",ref:d,style:{display:"none"},onChange:k,accept:"image/*",multiple:!0})]}),e("div",{className:"px-4 py-1 text-center",children:g&&e("div",{children:"Uploading..."})}),e("div",{className:"grid grid-cols-3 md:grid-cols-3 lg:grid-cols-6 gap-3 p-4",children:i.map((j,M)=>e("div",{className:"relative",children:e("img",{src:j.path,className:"w-full h-20 object-cover rounded-lg cursor-pointer",onClick:()=>o(M)})},M))}),u&&s(E,{children:[e("div",{className:"z-60 fixed bottom-0 top-0 left-0 right-0 bg-black bg-opacity-80 "}),e("div",{className:"z-80 fixed top-0 left-0 w-10 md:w-20 h-full cursor-pointer bg-black bg-opacity-80 hover:bg-opacity-100",onClick:v,children:e("div",{className:"flex items-center justify-center h-full",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-9-7 9-7"})})})}),e("div",{className:"z-70 fixed bottom-0 top-0 left-0 right-0",onClick:()=>m(!1),children:e("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e("img",{src:(x=i[C])==null?void 0:x.path,className:"w-full h-full object-cover rounded-lg"})})}),e("div",{className:"z-80 fixed right-0 top-0 w-10 md:w-20 h-full cursor-pointer bg-black bg-opacity-80 hover:bg-opacity-100",onClick:S,children:e("div",{className:"flex items-center justify-center h-full",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})})]})]})},We=()=>{const{appointment:t,updateNotes:h}=I(),a=t==null?void 0:t.notes;t==null||t.id;const[n,i]=l.useState(""),[f,g]=l.useState(!1),[y,d]=l.useState(0),b=z(r=>r.themeConfig.user),w=r=>{i(r.target.value);const k=(r.target.value.match(/\n/g)||[]).length+1;k>4?r.target.rows=4:r.target.rows=k},u=r=>{r.stopPropagation()},m=()=>{g(!0),D.post(`appointment/notes/${t==null?void 0:t.job_id}`,{text:n}).then(r=>{console.log(r),r.status===200&&(a==null||a.unshift(r.data.note),h(a||[]),i(""))}).catch(r=>{alert("Something went wrong. Please try again later"),console.log(r)}).finally(()=>{g(!1)})},C=r=>{d(r),D.delete(`appointment/notes/${r}`).then(k=>{k.status===200&&h((a==null?void 0:a.filter(c=>c.id!==r))||[])}).catch(k=>{alert("Something went wrong. Please try again later"),console.log(k)}).finally(()=>{d(0)})};return s("div",{className:"panel p-4 relative",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Notes"}),e(xe,{onWheel:u,className:"pb-10 max-h-[260px] scrollbar-container",children:e("div",{className:"table-responsive text-[#515365] dark:text-white-light font-semibold",children:e("table",{className:"whitespace-nowrap",children:s("tbody",{className:"dark:text-white",children:[(a==null?void 0:a.length)===0&&e("tr",{children:e("td",{children:e("div",{className:"text-center dark:text-gray-700 text-gray-400 mt-4",children:"Create first note..."})})}),a==null?void 0:a.map((r,k)=>{var c;return s("tr",{children:[s("td",{children:[s("div",{className:"creator dark:text-gray-600 text-gray-400",children:[(c=r.creator)==null?void 0:c.name," (",new Date(r.updated_at).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}),")"]}),e("div",{className:"note mt-1 ml-3 dark:text-gray-300 text-gray-500",dangerouslySetInnerHTML:{__html:r.text.replace(/\n/g,"<br>")}})]}),e("td",{className:"p-3 border-b border-[#ebedf2] dark:border-[#191e3a] text-right",children:e("div",{className:"text-right",children:y===r.id?e(ae,{}):r.creator.id===b.id&&e("button",{onClick:()=>C(r.id),type:"button",className:"ml-4",children:e(we,{})})})})]},k)})]})})})}),s("div",{className:"flex absolute bottom-2 right-2 left-2",children:[e("textarea",{rows:1,value:n,onChange:w,placeholder:"Type note here...",className:"form-textarea ltr:rounded-r-none rtl:rounded-l-none"}),e("button",{onClick:m,type:"button",className:"btn btn-secondary ltr:rounded-l-none rtl:rounded-r-none",children:f?e(B,{}):"Save"})]})]})},Ye=t=>{const h="$0.00",{appointment:a}=I(),[n,i]=l.useState((a==null?void 0:a.expenses)||[]),[f,g]=l.useState({title:"",amount:0,id:0}),[y,d]=l.useState(h),[b,w]=l.useState(!1),[u,m]=l.useState(0),C=o=>{const S=parseFloat(o.target.value.replace(/\D/g,""))/100;d(H(S)),g({...f,amount:S})},r=o=>{o.key==="Enter"&&c()},k=o=>{g({...f,[o.target.name]:o.target.value})},c=()=>{b||f.title===""||f.amount===0||(w(!0),D.post(`/appointment/expense/${a==null?void 0:a.job_id}`,f).then(o=>{o.status===200&&(console.log(o.data.expanse),i([...n,o.data.expanse]),g({title:"",amount:0,id:0}),d(h))}).catch(o=>{console.log(o)}).finally(()=>{w(!1)}))},p=o=>{m(o),D.delete(`/appointment/expense/${o}`).then(S=>{S.status===200&&i(n.filter(v=>v.id!==o))}).catch(S=>{console.log(S)}).finally(()=>{m(0)})};return s("div",{className:"panel p-4",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Expense"}),s("div",{className:"flex justify-between mt-4 gap-4",children:[e("div",{className:"w-3/5",children:e("input",{className:"form-input",value:f.title,placeholder:"Part number",name:"title",onChange:k,onKeyDown:r})}),e("div",{className:"",children:e("input",{className:"form-input",value:y,placeholder:"Cost",name:"cost",onChange:C,onKeyDown:r})}),e("div",{className:"",children:e("button",{className:"btn btn-primary",onClick:c,children:b?e(B,{}):"Add"})})]}),e("div",{className:"mt-4",children:s("div",{className:"grid grid-cols-3 gap-2",children:[e("div",{className:"col-span-2",children:n.map((o,S)=>s("div",{className:"grid grid-cols-4 mt-3 border-b border-gray-700 p-2 rounded",children:[e("div",{className:"text-sm font-semibold col-span-2",children:o.title}),e("div",{className:"text-sm font-semibold text-center",children:H(o.amount)}),e("div",{className:"action flex justify-end",children:e("span",{className:"text-danger cursor-pointer",onClick:()=>p(o.id),children:u===o.id?e(ae,{}):e(Pe,{})})})]},S))}),e("div",{className:"flex items-center justify-center j-full mt-2",children:s("div",{className:"text-center",children:[e("p",{className:"text-xl font-bold",children:H(n.reduce((o,S)=>o+parseFloat(S.amount.toString()),0))}),e("p",{children:"total"})]})})]})})]})},Ue=()=>{var c;const{appointment:t,updatePayments:h}=I(),[a,n]=l.useState(!1),i=((c=t==null?void 0:t.job)==null?void 0:c.total_paid)||0,[f,g]=l.useState(i),[y,d]=l.useState("full"),[b,w]=l.useState(!1),u=["Credit","Transfer","Check","Cash"];l.useEffect(()=>{g(i)},[i]);const m=p=>{if(isNaN(p.target.value))return;const o=p.target.value;g(o)},C=()=>{w(!0),D.post(`/appointment/payment/refund/${t==null?void 0:t.job.id}`,{amount:f,payment_type:u[r]}).then(p=>{p.status===200&&h([...(t==null?void 0:t.job.payments)||[],p.data.payment]),n(!1)}).catch(p=>{alert("Something went wrong. Please try again later"),console.log(p)}).finally(()=>{w(!1)})},[r,k]=l.useState(0);return s("div",{children:[e("button",{type:"button",className:"btn btn-outline-dark btn-sm",onClick:()=>n(!0),children:"Issue refund"}),e(L,{appear:!0,show:a,as:l.Fragment,children:s($,{as:"div",open:a,onClose:()=>n(!1),children:[e(L.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0"})}),e("div",{id:"login_modal",className:"fixed inset-0 bg-[black]/60 z-[999] overflow-y-auto",children:e("div",{className:"flex items-start justify-center min-h-screen px-4",children:e(L.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e($.Panel,{className:"panel border-0 py-1 rounded-lg overflow-hidden w-full max-w-lg my-8 text-black dark:text-white-dark",children:s("div",{className:"py-4 px-2",children:[e("div",{className:"title flex justify-between",children:s("span",{className:"text-success",children:["Total Paid: ",H(i)]})}),s("div",{className:"input-amount text-center text-5xl py-10",children:["$"," ",e("input",{type:"text",pattern:"\\d*\\.?\\d*",className:"w-[200px] bg-transparent border-b border-gray-700 text-center outline-none",value:f,onChange:m})]}),e("div",{className:"flex justify-center",children:e("button",{type:"button",onClick:()=>d("full"),className:`btn ${y==="full"?"btn-primary":"btn-outline-primary"}`,children:"Full"})}),e("div",{className:"payment-methods mt-10",children:e("div",{className:"relative inline-flex w-full align-middle justify-around",children:u.map((p,o)=>e("button",{onClick:()=>k(o),type:"button",className:`btn ${r===o?"btn-primary":"btn-outline-primary"} w-full ${o===0?"rounded-r-none":o===u.length-1?"rounded-l-none":"rounded-none"} `,children:p},o))})}),s("div",{className:"flex justify-end items-center mt-10",children:[e("button",{type:"button",onClick:()=>n(!1),className:"btn btn-outline-danger",children:"Discard"}),s("button",{type:"button",onClick:C,className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:["Refund Now",b&&e(B,{})]})]})]})})})})})]})})]})},ze=()=>{var w;const{appointment:t,updateServices:h}=I(),a=(t==null?void 0:t.job.services)||[],[n,i]=l.useState(!1),[f,g]=l.useState(!1),y=((w=t==null?void 0:t.job)==null?void 0:w.remaining_balance)||0,d=u=>{g(!0),u.id!==0?(console.log("update service:"),D.put(`appointment/service/${t==null?void 0:t.job_id}/${u.id}`,u).then(m=>{if(m.status===200){const C=a.map(r=>r.id===u.id?u:r);h(C),i(!1)}}).catch(m=>{alert("Something went wrong. Please try again later"),console.log(m)}).finally(()=>{g(!1)})):D.post(`appointment/service/${t==null?void 0:t.job_id}`,u).then(m=>{m.status===200&&(a.push(m.data.service),h(a),i(!1))}).catch(m=>{alert("Something went wrong. Please try again later"),console.log(m)}).finally(()=>{g(!1)})};return s("div",{className:"panel",children:[e("div",{className:"flex items-center justify-between",children:e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"Services"})}),s("div",{className:"mt-5",children:[e(Fe,{services:a,onRemoveService:u=>{D.delete(`appointment/service/${t==null?void 0:t.job_id}/${u}`).then(m=>{m.status===200&&h(a.filter(C=>C.id!==u))}).catch(m=>{m.response.status===403?alert("You are not allowed to delete this service"):alert("Something went wrong. Please try again later"),console.log(m)})},onSaveService:d,onUpdateService:d,modal:n,loadingStatus:f,isEditble:!0,setModal:i}),s("div",{className:"mt-4 flex justify-between items-center py-4",children:[s("div",{className:"text-sm",children:[y>0&&s("span",{className:"text-danger ml-2",children:["Remaining: ",H(y)]}),y<=0&&a.length>0&&e("span",{className:"text-success ml-2",children:"Paid full"})]}),e(Ue,{})]}),e("div",{className:"table-responsive text-[#515365] dark:text-white-light font-semibold",children:e("table",{className:"whitespace-nowrap",children:e("tbody",{className:"dark:text-white-dark",children:t==null?void 0:t.job.payments.map((u,m)=>s("tr",{children:[e("td",{children:P(u.created_at).format("MMM DD YYYY h:mm A")}),e("td",{children:u.type_text}),e("td",{children:H(u.amount)})]},m))})})})]})]})},Ve=()=>{const t=V(),[h,a]=l.useState(!1),{appointment:n,fetchAppointmentData:i,loadingStatus:f}=I(),{id:g}=Ne(),y=()=>{window.confirm("Are you sure you want to cancel this appointment?")&&(h||(a(!0),D.delete(`/appointment/${n==null?void 0:n.id}`).then(d=>{d.status===200&&t("/schedule")}).catch(d=>{console.log(d),alert("Something went wrong")}).finally(()=>{a(!1)})))};return l.useEffect(()=>{i(parseInt(g||"0"))},[g]),s(E,{children:[f==="loading"&&e(Ce,{}),f==="error"&&e(ke,{}),f==="success"&&s(E,{children:[e(Re,{}),s("div",{className:"py-4",children:[s("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[s("div",{className:"grid grid-rows-none gap-5",children:[e("div",{className:"panel p-4",children:e(Be,{})}),s("div",{className:"panel p-4",children:[e("h3",{className:"font-semibold text-lg dark:text-white-light",children:"All Visits"}),e("div",{className:"text-right",children:n==null?void 0:n.job.appointments.map((d,b)=>{var w;return e("div",{className:"mb-2 last:mb-0",children:e(W,{to:`/appointment/${d.id}`,children:e("div",{className:`rounded-md p-2 ${n.id===d.id?"dark:bg-gray-800 dark:shadow-gray-600 bg-gray-200 shadow-gray-500 shadow-sm":"dark:bg-dark-dark-light bg-gray-100"}   border-l-2`,style:{borderColor:((w=d.techs)==null?void 0:w.length)>0?d.techs[d.techs.length-1].color:"#1565C0"},children:s("div",{className:"text-sm font-semibold flex justify-between",children:[e("div",{children:_(d.start,"MMM DD, YYYY")}),s("div",{children:[_(d.start,"hh:mm A")," - ",_(d.end,"hh:mm A")]})]})})})},b)})})]})]}),s("div",{className:"md:col-span-3 grid grid-cols-1 xl:grid-cols-2 gap-5",children:[s("div",{className:"grid grid-flow-row gap-5",children:[e(Ze,{}),e("div",{className:"panel p-4 hidden md:block",children:e(X,{})}),e("div",{className:"panel p-0 hidden md:block",children:e(ee,{appointmentId:n==null?void 0:n.id})})]}),s("div",{className:"grid grid-flow-row gap-5",children:[e(ze,{}),e(Ye,{}),e(We,{}),e("div",{className:"panel p-4 block md:hidden",children:e(X,{})}),e("div",{className:"panel p-0 block md:hidden",children:e(ee,{appointmentId:n==null?void 0:n.id})})]})]})]}),e("div",{className:"text-center mt-6",children:e("div",{className:"text-danger cursor-pointer",onClick:y,children:h?"Canceling...":"Cancel Appointment"})})]})]})]})},tt=()=>{const[t,h]=l.useState({}),a=Se();return l.useEffect(()=>{a(Te("Appointment"))}),e("div",{children:e(Ie,{appointmentData:t,children:e(Ve,{})})})};export{tt as default};
