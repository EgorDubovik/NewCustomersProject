import{r,b as a,j as y,R as z}from"./index-57ee91f8.js";import{h as m}from"./moment-a9aaa855.js";const G=n=>{const o=n.appointmentList||[],T=n.daysArray||[],N=n.startTime||null;n.endTime;const P=n.timesArray||[],M=n.totalDuration||null,E=n.blockHeight||50,C=n.onAppointmentClick||null,g=n.setAppointmentForCurentDate||null,I=r.useRef(null),f=r.useRef(0),S=r.useRef(0),Y=l=>{const h=l.clone().set({hour:N.hour(),minute:N.minute()});return m.duration(l.diff(h)).asMinutes()/M.asMinutes()*100},x=l=>Math.round(M.asMinutes()*l/100),v=r.useRef(!1),R=r.useRef(0),i=r.useRef(0),b=r.useRef(0),d=r.useRef(null),H=r.useRef(0),w=r.useRef(0),A=r.useRef(0),p=r.useRef(0),O=15*100/M.asMinutes(),B=r.useRef(0),D=r.useRef(!1),j=(l,h)=>{if(l.target.className.indexOf("appointment-title")!=-1)return;A.current=h,d.current=l.currentTarget;const e=l.currentTarget.closest(".day-inner");f.current=e.getBoundingClientRect().height,S.current=e.getBoundingClientRect().top,d.current&&(i.current=d.current.getBoundingClientRect().top,w.current=d.current.getBoundingClientRect().height,d.current.style.zIndex="100",d.current.style.width="100%",d.current.style.left="0%"),b.current=i.current-S.current,H.current=Y(o[h].end)-Y(o[h].start),R.current=l.clientY,B.current=O*f.current/100,v.current=!0},F=l=>{if(!v.current)return;let h=l.clientY-R.current,e=b.current+h;e>=0&&w.current+e<=f.current&&(D.current=!0,e=Math.round(e/B.current)*B.current,p.current=e/f.current*100,d.current&&(d.current.style.top=p.current+"%"))},L=()=>{if(!v.current||!D.current){v.current=!1,D.current=!1;return}o[A.current].start=m(o[A.current].start.format("YYYY-MM-DD")+" "+N.format("HH:mm")).add(x(p.current),"minutes"),o[A.current].end=m(o[A.current].end.format("YYYY-MM-DD")+" "+N.format("HH:mm")).add(x(p.current+H.current),"minutes"),v.current=!1,d.current&&(d.current.style.zIndex="1"),D.current=!1,g(o)};return a("div",{className:"dates grid  w-full",style:{gridTemplateColumns:`repeat(${T.length}, minmax(0, 1fr))`},children:T.map((l,h)=>a("div",{className:"date pt-2 first:border-0 border-l dark:border-gray-600 border-gray-300",children:y("div",{className:"day-inner relative h-full",ref:I,children:[a("div",{className:"appointments-list absolute h-full left-0 top-0 right-0",onMouseUp:L,onMouseMove:F,children:o.map((e,t)=>{if(e.start.format("ddd DD")===l)return y("div",{onMouseDown:s=>{j(s,t)},className:"appointment text-[.8em]  absolute p-[2px] cursor-pointer",style:{height:e.height+"%",width:e.width+"%",left:e.left+"%",top:e.top+"%"},children:[a("div",{className:"appointment-conteiner rounded absolute",style:{background:e.bg,inset:"1px",opacity:e.opacity??.8}}),y("div",{className:(e.addClass??"")+" sticky font-bold",children:[a("div",{className:"appointment-title px-2 pt-1 hover:underline ",onClick:()=>{C(e)},children:e.title}),y("div",{className:"appointment-time px-2",children:[e.start.format("hh:mm A")," - ",e.end.format("hh:mm A")]})]})]},e.title+"-"+t+e.top)})}),P.map((e,t)=>a("div",{className:"date-time dark:border-gray-600 border-gray-300 border-t",style:{height:E+"px"}},t))]})},h))})},U=n=>{const o=m(n.startTime||"00:00","HH:mm"),T=m(n.endTime||"23:00","HH:mm"),N=n.isHeader!==void 0?n.isHeader:!0,P=n.isDaysNames!==void 0?n.isDaysNames:!0,M=n.eventDefoultBgColor||"#1565c0",E=T.clone().add(1,"hour"),C=m.duration(E.diff(o)),[g,I]=r.useState([]),[f,S]=r.useState(n.viewType||"week"),Y=n.scheduleBgClass||"bg-white dark:bg-gray-800",x=n.blockHeight||50,v=n.onClickHandler||null,R=n.appointments||[],[i,b]=r.useState(m(n.currentDate)||m()),[d,H]=r.useState([]);r.useEffect(()=>{b(m(n.currentDate))},[n.currentDate]);const w={calculateTimePercentage:e=>{const t=e.clone().set({hour:o.hour(),minute:o.minute()});return m.duration(e.diff(t)).asMinutes()/C.asMinutes()*100},getTimesArray:(e=60)=>{const t=[],s=o.clone(),k=T.clone();for(;s<=k;)t.push(s.format("hh A")),s.add(e,"minutes");return t},procentToMinutes:function(e){var t=Math.round(C.asMinutes()*e/100);return t},getDaysArray:function(){if(f==="week")for(let e=0;e<7;e++)g[e]=i.clone().weekday(e).format("ddd")+" "+i.clone().weekday(e).format("DD");else f==="day"&&(g[0]=i.format("ddd")+" "+i.format("DD"));return g}},A=e=>{let t=i.clone().startOf("week"),s=i.clone().endOf("week");return e.filter(u=>(u.start=m(u.start),u.end=m(u.end),u.bg=u.bg||M,u.start.isBetween(t,s)||u.end.isBetween(t,s)||u.start.isBefore(t)&&u.end.isAfter(s))).sort((u,$)=>u.start-$.start)},p=e=>{let t=[];return e.forEach(s=>{const k=t.find(c=>s.start.isBetween(c.start,c.end,null,"[)")||s.end.isBetween(c.start,c.end,null,"(]"));k?k.appointments.push(s):t.push({start:s.start,end:s.end,appointments:[s]})}),t},O=e=>{let t=[];return e.forEach(s=>{const k=s.appointments;k.forEach((c,u)=>{c.width=100/k.length,c.left=c.width*u,c.top=w.calculateTimePercentage(c.start),c.bottom=w.calculateTimePercentage(c.end),c.height=c.bottom-c.top,t.push(c)})}),t},B=e=>{v&&v(e)},D=w.getTimesArray();r.useEffect(()=>{let e=A(R);H(e),I(w.getDaysArray())},[i,R,f]);let j=p(d),F=O(j);const L=()=>{f==="week"&&b(i.clone().subtract(1,"week")),f==="day"&&b(i.clone().subtract(1,"days"))},l=()=>{f==="week"&&b(i.clone().add(1,"week")),f==="day"&&b(i.clone().add(1,"days"))},h=()=>{b(m())};return a("div",{className:"select-none",children:y("div",{className:"scheduler-container rounded "+Y+" p-4",children:[N&&y("div",{className:"scheduler-header flex justify-between",children:[a("div",{className:"scheduler-date text-base",children:i.format("MMMM YYYY")}),y("div",{className:"scheduler-nav flex gap-4",children:[a("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:L,children:"<"}),a("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:h,children:"Today"}),a("button",{className:"btn btn-sm btn-outline btn-outline-primary",onClick:l,children:">"})]})]}),y("div",{className:"scheduler-body",children:[P&&y("div",{className:"scheduler-weekdays flex pt-4 pb-4 border-b dark:border-gray-600 border-gray-300",children:[a("div",{className:"first-item w-10"}),a("div",{className:"weekdays text-center grid w-full",style:{gridTemplateColumns:`repeat(${g.length}, minmax(0, 1fr))`},children:g.map((e,t)=>a("div",{className:"weekday",children:e},t))},g.length)]}),y("div",{className:"scheduler-dates flex relative",children:[a("div",{className:"times text-[0.8em] w-10 pt-2",children:D.map((e,t)=>a("div",{className:"time  border-t border-transparent",style:{height:x+"px"},children:a("div",{className:"time-title  -mt-2",children:e})},t))}),a(G,{blockHeight:x,startTime:o,endTime:T,timesArray:D,daysArray:g,appointmentList:F,setAppointmentForCurentDate:H,onAppointmentClick:B,totalDuration:C})]})]})]})})},q=z.memo(U);export{q as A};
